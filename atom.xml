<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Doublemine</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://notes.wanghao.work/"/>
  <updated>2016-11-24T14:11:04.000Z</updated>
  <id>https://notes.wanghao.work/</id>
  
  <author>
    <name>夏末</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Mac自带VNC Client</title>
    <link href="https://notes.wanghao.work/2016-11-24-Mac%E8%87%AA%E5%B8%A6VNC-Client.html"/>
    <id>https://notes.wanghao.work/2016-11-24-Mac自带VNC-Client.html</id>
    <published>2016-11-24T13:57:28.000Z</published>
    <updated>2016-11-24T14:11:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>由于有需要远程VNC的需要，苦苦寻找一款Mac上比较好使的VNC Client，结果经人指点，发现原来MacOS自带了VNC Client，只是没有在Launchpad中显示罢了。使用<code>command</code>+<code>space</code> 调出<code>Spotlight搜索</code>键入<code>screen Sharing.app</code>即可。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于有需要远程VNC的需要，苦苦寻找一款Mac上比较好使的VNC Client，结果经人指点，发现原来MacOS自带了VNC Client，只是没有在Launchpad中显示罢了。使用&lt;code&gt;command&lt;/code&gt;+&lt;code&gt;space&lt;/code&gt; 调出&lt;co
    
    </summary>
    
    
      <category term="Mac" scheme="https://notes.wanghao.work/tags/Mac/"/>
    
      <category term="Tips" scheme="https://notes.wanghao.work/tags/Tips/"/>
    
  </entry>
  
  <entry>
    <title>开启Git大小写敏感</title>
    <link href="https://notes.wanghao.work/2016-11-24-%E5%BC%80%E5%90%AFGit%E5%A4%A7%E5%B0%8F%E5%86%99%E6%95%8F%E6%84%9F.html"/>
    <id>https://notes.wanghao.work/2016-11-24-开启Git大小写敏感.html</id>
    <published>2016-11-24T13:35:57.000Z</published>
    <updated>2016-11-24T13:53:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近公司开发的项目的时候，自己或者队友都经常会手抖针对某些文件的命名规范大小写写错。（毕竟入冬了。。）尤其是包名小写手抖写成大写了。。又由于我设置Android Studio新建文件自动添加到Git，一来二往，导致推上服务器之后发现自己命名有问题，顺手改成小写，这个时候问题就来了。</p>
<p>由于Git默认是大小写不敏感的，导致我这边虽然修改了，然而队友那边还是老样子，可能会导致后续的提交出现问题让项目无法编译通过，虽然不是什么大问题，稍微小改一下就行。然而鉴于这种问题出现了几次，每次都手动修改还是挺闹心的。我们还是来动手让Git区分大小写吧。</p>
<p>如果只是想应用于当前项目，那么在当前项目中使用执行以下<code>Git命令</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config core.ignorecase false</div></pre></td></tr></table></figure>
<p>当然，如果想一劳永逸的话，推荐还是做一个全局配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --global core.ignorecase false</div></pre></td></tr></table></figure>
<p>这样之后的项目都不用担心大小写都问题闹心了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近公司开发的项目的时候，自己或者队友都经常会手抖针对某些文件的命名规范大小写写错。（毕竟入冬了。。）尤其是包名小写手抖写成大写了。。又由于我设置Android Studio新建文件自动添加到Git，一来二往，导致推上服务器之后发现自己命名有问题，顺手改成小写，这个时候问题
    
    </summary>
    
    
      <category term="Git" scheme="https://notes.wanghao.work/tags/Git/"/>
    
      <category term="Tips" scheme="https://notes.wanghao.work/tags/Tips/"/>
    
  </entry>
  
  <entry>
    <title>基于LeanCloud、Telegram实现多说评论推送</title>
    <link href="https://notes.wanghao.work/2016-10-26-%E5%9F%BA%E4%BA%8ELeanCloud%E3%80%81Telegram%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%AF%B4%E8%AF%84%E8%AE%BA%E6%8E%A8%E9%80%81.html"/>
    <id>https://notes.wanghao.work/2016-10-26-基于LeanCloud、Telegram实现多说评论推送.html</id>
    <published>2016-10-25T16:19:53.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>众所周知多说评论是不支持主动推送的，也就是说如果访客主动留言评论，多说是不会给我们邮件推送提醒的。但是我们总不能每隔一段时间去检查下博客的评论留言吧，这样效率也太低了ヾ(。￣□￣)ﾂ゜゜゜于是趁着最近闲的蛋疼折腾出了这么个东东，能够实现访客主动评论的时候，在5分钟之内响应并通过Telegram推送到手机上方便查看和浏览。</p>
<hr>
<p>嗯，相关的源码和基本的部署说明丢在Github上了,感兴趣的可以<font color="red"><strong><a href="https://github.com/Doublemine/TelegramBot" target="_blank" rel="external">戳此查看</a></strong></font>。</p>
<ul>
<li><a href="https://github.com/Doublemine/TelegramBot" target="_blank" rel="external">Telegram Bot For DuoShuo</a></li>
</ul>
<p>目前保证基本的功能能够稳定的运行，后续再添加一些其它的功能吧。嗯，详细的配置说明先挖个坑，改天再写。懒癌犯了，先休息~</p>
<p><img src="http://7xk0q3.com1.z0.glb.clouddn.com/%E6%97%A0%E5%A5%88%E7%9A%84%E7%8B%97%E7%8B%97.jpg" alt="" title="休息"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;众所周知多说评论是不支持主动推送的，也就是说如果访客主动留言评论，多说是不会给我们邮件推送提醒的。但是我们总不能每隔一段时间去检查下博客的评论留言吧，这样效率也太低了ヾ(。￣□￣)ﾂ゜゜゜于是趁着最近闲的蛋疼折腾出了这么个东东，能够实现访客主动评论的时候，在5分钟之内响应并
    
    </summary>
    
      <category term="Python" scheme="https://notes.wanghao.work/categories/Python/"/>
    
    
      <category term="LeanCloud" scheme="https://notes.wanghao.work/tags/LeanCloud/"/>
    
      <category term="Python" scheme="https://notes.wanghao.work/tags/Python/"/>
    
      <category term="Telegram" scheme="https://notes.wanghao.work/tags/Telegram/"/>
    
  </entry>
  
  <entry>
    <title>当Android应用被强杀之后</title>
    <link href="https://notes.wanghao.work/2016-09-10-AndroidProcessbeKilledweShoudIDo.html"/>
    <id>https://notes.wanghao.work/2016-09-10-AndroidProcessbeKilledweShoudIDo.html</id>
    <published>2016-09-10T11:00:20.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>Android应用在后台运行的时候很容易被强杀，尤其是在国内XX助手、XX管家、XX大师之类的应用大行其道之下。如果我们开发的应用没有被用户加入白名单，很大程度上会被系统因为内存不足或者用户主动给应用在后台运行的时候杀掉。这个时候问题就来了：</p>
<ul>
<li><strong>如何保证我们的应用在被强杀之后用户再次回到应用来保证应用的稳定性而不Crash？</strong></li>
</ul>
<p>为了说明上述问题，我们来简单模拟这样一个过程:</p>
<blockquote>
<p>APP –&gt; ActivityA –&gt; ActivityB –&gt;ActivityC –&gt; Pressed Home</p>
</blockquote>
<p>假设APP在Activity C页面用户按下<code>Home</code>键应用退到后台运行。这个时候启动DDMS，选中该APP的进程，Kill。然后我们从运行APP历史列表中选中该APP并将其置于前台，这个时候回到该应用的界面还是Activity C。再点击返回按钮回到ActivityB，在某些性能比较差一点的机器上可能会出现短暂的黑屏然后才会显示出ActivityB。这是因为该Activity实例其实在Kill该APP进程的时候已经被销毁了，但是Android系统虽然销毁了Activity实例，却并没有销毁该APP的Activity栈。因此我们点击返回按钮还是会回到ActivityB。但是需要重新构建该ActivityB的实例。</p>
<p>这样看貌似并没有什么问题，然而事情并不会这么简单（废话，不然我写这篇博客干嘛。。），如果ActivityB中引用了静态变量并尝试获取其值的时候，这个时候是会出现NPE的。</p>
<a id="more"></a>
<p>我们简单来总结下上述过程:</p>
<ol>
<li><p>当应用在后台被Kill，整个APP进程都被销毁，所有变量都被清空，包括Application的实例。</p>
</li>
<li><p>虽然所有变量和实例都被销毁，但是Activity栈并没有被清空，所以我们回到应用还能得知页面的打开顺序。</p>
</li>
<li><p>当应用被强杀时，会自动调用<code>onSaveInstance</code>方法去保存一些核心变量，然而这在面对N多的页面的时候显然不是一件省心的事情，而且你也不能保证你的队友也会这么做。。</p>
</li>
<li><p>在某些性能比较低或者页面逻辑比较复杂的页面会黑屏是因为需要重建ActivityB的实例，也就是需要重走Activity的声明周期<code>OnCreate</code>，性能差点的机器上自然就会有短暂的黑屏了。</p>
</li>
</ol>
<p>如果APP中没有静态变量的引用，那就不会出现NEP，但是一旦引用了静态变量，这个时候可能就比较危险了。（静态变量包括全局的登录状态，全局的用户配置、标志位之类的数据）当然了，如果你能将所有的静态变量修改到单例中去，并将其持久化，为NULL的时候再去取的话，原则上来说这样也可以避免NPE。然而要是这样做的话很大程度上会减缓开发的进度，而且指不定哪个队友就给你挖坑了。然后你怎么挂的都不知道。。</p>
<p>为了一劳永逸的解决这个问题，我们需要冷静下来思考一下:<strong>既然APP被强杀了，为啥还要回到原先的页面中去而不是重走启动APP的流程?</strong></p>
<p>我们虽然不能阻止Android系统销毁实例却保存Activity栈，也不想多写那些持久化或者Cache静态变量代码（这将是一件费力而且不太讨好的事情）所以我们唯一能做的就是检测应用是否被强杀，并且在被强杀之后重走启动流程而不是回到原先的逻辑当中。</p>
<p>以下给出我的一种实现方式，如果你有更好的想法，欢迎和我交流:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> FLAG;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> FLAG_NOT_INIT = <span class="number">200</span>;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    <span class="keyword">if</span> (FLAG != FLAG_NOT_INIT) &#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.getClass() == LauncherActivity.class) &#123;</div><div class="line">        FLAG = FLAG_NOT_INIT;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        reLauncher();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们实例化上述场景，给出一种对应关系:</p>
<p>ActivityA –&gt; 启动页</p>
<p>ActivityB –&gt; 主页</p>
<p>ActivityC –&gt; 详情页</p>
<p>其中将ActivityB的<code>launchMode</code>设置为<code>singleTask</code>，并且在BaseActivity中使用静态变量FLAG进行判断当前应用是否被强杀，如果被强杀则利用ActivityB的<code>launchMode</code>特性清空栈并重新初始化即可。</p>
<p>######有关Activity的启动模式相关文章，可参阅<a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0520/2897.html" target="_blank" rel="external">Activity启动模式图文详解</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Android应用在后台运行的时候很容易被强杀，尤其是在国内XX助手、XX管家、XX大师之类的应用大行其道之下。如果我们开发的应用没有被用户加入白名单，很大程度上会被系统因为内存不足或者用户主动给应用在后台运行的时候杀掉。这个时候问题就来了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;如何保证我们的应用在被强杀之后用户再次回到应用来保证应用的稳定性而不Crash？&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为了说明上述问题，我们来简单模拟这样一个过程:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;APP –&amp;gt; ActivityA –&amp;gt; ActivityB –&amp;gt;ActivityC –&amp;gt; Pressed Home&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;假设APP在Activity C页面用户按下&lt;code&gt;Home&lt;/code&gt;键应用退到后台运行。这个时候启动DDMS，选中该APP的进程，Kill。然后我们从运行APP历史列表中选中该APP并将其置于前台，这个时候回到该应用的界面还是Activity C。再点击返回按钮回到ActivityB，在某些性能比较差一点的机器上可能会出现短暂的黑屏然后才会显示出ActivityB。这是因为该Activity实例其实在Kill该APP进程的时候已经被销毁了，但是Android系统虽然销毁了Activity实例，却并没有销毁该APP的Activity栈。因此我们点击返回按钮还是会回到ActivityB。但是需要重新构建该ActivityB的实例。&lt;/p&gt;
&lt;p&gt;这样看貌似并没有什么问题，然而事情并不会这么简单（废话，不然我写这篇博客干嘛。。），如果ActivityB中引用了静态变量并尝试获取其值的时候，这个时候是会出现NPE的。&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://notes.wanghao.work/categories/Android/"/>
    
    
      <category term="Android" scheme="https://notes.wanghao.work/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android之Keystore文件签名</title>
    <link href="https://notes.wanghao.work/2016-07-03-Android%E4%B9%8BKeystore%E6%96%87%E4%BB%B6%E7%AD%BE%E5%90%8D.html"/>
    <id>https://notes.wanghao.work/2016-07-03-Android之Keystore文件签名.html</id>
    <published>2016-07-03T12:58:16.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>Android应用开发的时候会经常使用到第三方SDK，例如地图、推送、支付以及分享等。而这些第三方服务SDK为了应用不被滥用都会有签名验证机制。我们通过上传Android应用的签名来在服务端配置以验证应用的合法性。本文将讲述下在Android Stduio中常用的签名操作。</p>
<h3 id="默认KeyStore"><a href="#默认KeyStore" class="headerlink" title="默认KeyStore"></a>默认KeyStore</h3><h4 id="默认KeyStore存储路径"><a href="#默认KeyStore存储路径" class="headerlink" title="默认KeyStore存储路径"></a>默认KeyStore存储路径</h4><p>在Android Stduio中系统默认内置了一个签名文件<code>debug.keystore</code>，用于我们在debug下的默认App签名。如果没有在Gradle文件中特殊指定，那么Android Studio将自动使用默认的<code>debug.keystore</code>文件为项目App生成Debug版本的签名。</p>
<a id="more"></a>
<ul>
<li><p>在Mac/Linux系统中，<code>debug.keystore</code>文件默认储存在<code>~/.android/</code>路径下。</p>
</li>
<li><p>在Windows系统中，<code>debug.keystore</code>文件将默认存储在<code>C:\Users\{USERNAME}\.android\</code>路径下。</p>
</li>
</ul>
<h4 id="获取默认KeyStore-SHA-1"><a href="#获取默认KeyStore-SHA-1" class="headerlink" title="获取默认KeyStore SHA-1"></a>获取默认KeyStore <code>SHA-1</code></h4><p>知道了Android Stduio 默认的<code>debug.keystore</code>之后，下一步我们将是要获取其指纹信息，以便于在第三方服务配置中填入Debug指纹信息。</p>
<ul>
<li>在Linux/Mac系统中，打开终端并输入以下命令:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android</div></pre></td></tr></table></figure>
<ul>
<li>在Windows系统中，在CMD中输入以下命令:</li>
</ul>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -list -v -keystore "<span class="variable">%USERPROFILE%</span>\.android\debug.keystore" -alias androiddebugkey -storepass android -keypass android</div></pre></td></tr></table></figure>
<p>回车执行之后，你将会看到类似下面的<code>debug.keystore</code>输出提示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">别名: androiddebugkey</div><div class="line">创建日期: 2015-11-18</div><div class="line">条目类型: PrivateKeyEntry</div><div class="line">证书链长度: 1</div><div class="line">证书[1]:</div><div class="line">所有者: CN=Android Debug, O=Android, C=US</div><div class="line">发布者: CN=Android Debug, O=Android, C=US</div><div class="line">序列号: b15af1</div><div class="line">有效期开始日期: Wed Nov 18 07:18:45 CST 2015, 截止日期: Fri Nov 10 07:18:45 CST 2045</div><div class="line">证书指纹:</div><div class="line">         MD5: FE:A1:9C:02:71:A2:DA:F9:7F:1C:2B:61:D7:65:89:44</div><div class="line">         SHA1: 01:DF:58:7D:04:3E:76:B5:92:98:37:0E:DD:70:61:01:70:F5:C9:8E</div><div class="line">         SHA256: 84:18:44:C2:BD:AD:5D:A8:88:A1:96:EF:A6:27:86:0A:36:44:31:38:F2:5F:B6:4E:F1:10:EE:93:D6:22:CD:59</div><div class="line">         签名算法名称: SHA256withRSA</div><div class="line">         版本: 3</div><div class="line"></div><div class="line">扩展:</div></pre></td></tr></table></figure>
<p>我们将其中的证书指纹填入到第三方服务DEBUG配置中即可。当然了，有的时候出于这样或者那样的原因考虑，我们并不想使用系统默认的KeyStore或者就想自己生成一个新的KeyStore，Debug环境与Release环境都使用同一个来减少配置的麻烦。这个时候我们就需要创建一个新的KeyStore文件了。</p>
<h3 id="创建新的KeyStore"><a href="#创建新的KeyStore" class="headerlink" title="创建新的KeyStore"></a>创建新的KeyStore</h3><p>我们使用JDK自带的Keytool命令行工具即可完成KeyStore密钥库文件的创建，此处需要说明的是，Android Stduio中自带的图形化界面<code>KeyStore</code>生成工具生成的<code>.jks</code>文件与Keytool生成的<code>.keystore</code>文件在使用上没有任何区别。</p>
<h4 id="生成KeyStore"><a href="#生成KeyStore" class="headerlink" title="生成KeyStore"></a>生成KeyStore</h4><p>在终端中键入以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -genkey -v -keystore &#123;FILENAME.keystore&#125; -alias &#123;ALIAS&#125; -keyalg RSA -validity &#123;DURATION&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>{FILENAME.keystore}</code> 为生成的KeyStore的文件名</li>
<li><code>{ALIAS}</code> 为生成的KeyStore文件的别名</li>
<li><code>{DURATION}</code> 为该KeyStore文件的过期时间</li>
</ul>
<p>下面将以生成一个test.keystore文件为示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -genkey -v -keystore test.keystore -alias <span class="built_in">test</span> -keyalg RSA -validity 365</div></pre></td></tr></table></figure>
<p>键入以上命令将生成一个以RSA算法加密的有效期365天的名为<code>test.keystore</code>的文件，该KeyStore文件的alias为 test。回车确认执行该命令之后，将会要求输入密钥库口令以及一些基本的信息，根据提示输入无误之后将会在当前终端所在目录生成指定的KeyStore文件。完整的示例如下所示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$ keytool -genkey -v -keystore test.keystore -alias <span class="built_in">test</span> -keyalg RSA -validity 365</div><div class="line">输入密钥库口令:  android</div><div class="line">再次输入新口令: android</div><div class="line">您的名字与姓氏是什么?</div><div class="line">  [Unknown]:  Doublemine</div><div class="line">您的组织单位名称是什么?</div><div class="line">  [Unknown]:  Test</div><div class="line">您的组织名称是什么?</div><div class="line">  [Unknown]:  Test</div><div class="line">您所在的城市或区域名称是什么?</div><div class="line">  [Unknown]:  Test</div><div class="line">您所在的省/市/自治区名称是什么?</div><div class="line">  [Unknown]:  Test</div><div class="line">该单位的双字母国家/地区代码是什么?</div><div class="line">  [Unknown]:  Test</div><div class="line">CN=Doublemine, OU=Test, O=Test, L=Test, ST=Test, C=Test是否正确?</div><div class="line">  [否]:  y</div><div class="line"></div><div class="line">正在为以下对象生成 2,048 位RSA密钥对和自签名证书 (SHA256withRSA) (有效期为 365 天):</div><div class="line">         CN=Doublemine, OU=Test, O=Test, L=Test, ST=Test, C=Test</div><div class="line">输入 &lt;<span class="built_in">test</span>&gt; 的密钥口令</div><div class="line">        (如果和密钥库口令相同, 按回车):</div><div class="line">[正在存储test.keystore]</div></pre></td></tr></table></figure>
<p>这样我们就有了一个全新的KeyStore文件可以用于Android的App签名，有了KeyStore文件下一步当然就是获取我们生成的KeyStore文件的指纹信息咯~</p>
<h4 id="获取KeyStore指纹信息"><a href="#获取KeyStore指纹信息" class="headerlink" title="获取KeyStore指纹信息"></a>获取KeyStore指纹信息</h4><p>与获取默认的<code>debug.keystore</code>文件指纹信息类似，我们在终端中键入以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -v -list -keystore test.keystore -alias <span class="built_in">test</span> -keypass android -storepass android</div></pre></td></tr></table></figure>
<p>即可获取到我们生成的KeyStore指纹信息，有的同学已经看出来了，只要将上述命令中的几个参数替换下，即可查看任意KeyStore的指纹信息:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -v -list -keystore &#123;FILENAME.keystore&#125; -alias &#123;ALIAS&#125; -keypass &#123;KEYPASSWD&#125; -storepass &#123;STOREPASSWD&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>{FILENAME.keystore}</code>为keystore文件名</li>
<li><code>{ALIAS}</code>为KeyStore的别名</li>
<li><code>{KEYPASSWD}</code>为KeyStore的密钥口令</li>
<li><code>{STOREPASSWD}</code>为KeyStore的密钥库口令</li>
</ul>
<h3 id="应用KeyStore"><a href="#应用KeyStore" class="headerlink" title="应用KeyStore"></a>应用KeyStore</h3><p>前面我们忙活了大半天生成了KeyStore文件，并查看其指纹信息。但是如果我们不使用到我们的项目中，毕竟还是不会对我们的项目生效的~我们还需要在Gradle脚本中对其进行配置，我们的项目才会应用其KeyStore文件。</p>
<p>其中我们有两种较为普遍的方式在项目中配置我们的KeyStore文件，第一种比较简单粗暴，直接在gradle构建脚本中写入KeyStore信息,第二种则将KeyStore信息配置在一个单独的配置文件中，在gradle构建时动态读取。</p>
<h4 id="签名信息写入Gradle脚本"><a href="#签名信息写入Gradle脚本" class="headerlink" title="签名信息写入Gradle脚本"></a>签名信息写入Gradle脚本</h4><p>在Android Stduio中打开主moudle的<code>build.gradle</code>文件,在其中的<code>android</code>闭包中键入如下内容:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">signingConfigs &#123;</div><div class="line">    release &#123;</div><div class="line">      keyAlias <span class="string">'test'</span></div><div class="line">      keyPassword <span class="string">'android'</span></div><div class="line">      storeFile <span class="keyword">file</span>(<span class="string">'./keystore/test.keystore'</span>)</div><div class="line">      storePassword <span class="string">'android'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>其中声明的release闭包中包含了<code>keyAlias</code>、<code>keyPassword</code>、<code>storeFile</code>、<code>storePassword</code>四个Property。其中含义分别为:</p>
<ul>
<li><code>keyAlias</code> keystore的<code>alias</code></li>
<li><code>keyPassword</code> KeyStore的密钥口令</li>
<li><code>storeFile</code>为KeyStore的文件存放路径，可以为相对或者绝对路径，此处使用的为相对路径</li>
<li><code>storePassword</code>为KeyStore的密钥库口令</li>
</ul>
<p>以上的Gradle DSL将会作用于我们的项目的Release版本，当我们在终端中个输入:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradlew assembleRelease</div></pre></td></tr></table></figure>
<p>项目将会使用我们上面定义的<code>test.keystore</code>密钥库文件签名打包项目为Release发布版。</p>
<p>同样，如果我们不想使用默认的<code>debug.keystore</code>签名项目的Debug版本，我们亦可以重新生成一个KeyStore文件或者使用Release版本的签名该文件，放入debug闭包中即可:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">signingConfigs &#123;</div><div class="line">    release &#123;</div><div class="line">      keyAlias <span class="string">'test'</span></div><div class="line">      keyPassword <span class="string">'android'</span></div><div class="line">      storeFile <span class="keyword">file</span>(<span class="string">'./keystore/test.keystore'</span>)</div><div class="line">      storePassword <span class="string">'android'</span></div><div class="line">    &#125;</div><div class="line">    debug &#123;</div><div class="line">     keyAlias <span class="string">'test'</span></div><div class="line">      keyPassword <span class="string">'android'</span></div><div class="line">      storeFile <span class="keyword">file</span>(<span class="string">'./keystore/test.keystore'</span>)</div><div class="line">      storePassword <span class="string">'android'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="签名信息写入配置文件"><a href="#签名信息写入配置文件" class="headerlink" title="签名信息写入配置文件"></a>签名信息写入配置文件</h4><p>细心的同学可能发现了，虽然上面的把签名信息写入gradle脚本中比较方便省事，但是却在密钥文件的密钥密码泄露问题，任何能够看到此Moudle的build.gradle脚本的人都可以拿到KeyStore文件及其对应的密钥口令，可能会导致一些安全风险。因此在一些开源项目或者比较敏感的项目中，可能会存在类似的gradle配置:</p>
<p>在主moudle的build.gradle脚本的android闭包中:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">applicationVariants.all &#123;  </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">project</span>.hasProperty(<span class="string">'keyAlias'</span>) &amp;&amp; <span class="keyword">project</span>.hasProperty(<span class="string">'storeFile'</span>) &amp;&amp;</div><div class="line">    <span class="keyword">project</span>.hasProperty(<span class="string">'storePassword'</span>) &amp;&amp;</div><div class="line">    <span class="keyword">project</span>.hasProperty(<span class="string">'keyPassword'</span>)) &#123;</div><div class="line">  android.signingConfigs.release.keyAlias = keyAlias</div><div class="line">  android.signingConfigs.release.storeFile = <span class="keyword">file</span>(storeFile)</div><div class="line">  android.signingConfigs.release.storePassword = storePassword</div><div class="line">  android.signingConfigs.release.keyPassword = keyPassword</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  android.buildTypes.release.signingConfig = <span class="keyword">null</span></div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中<code>Variants</code>翻译中文为<code>变种</code>,<code>applicationVariants.all</code>属性含义为<code>app plugin</code>下所有的<code>Variant</code>的配置信息，可以将其看作为一个总览，可以方便的访问所有对象。<br><a href="http://tools.android.com/tech-docs/new-build-system/user-guide" target="_blank" rel="external">相关延伸阅读Gradle Plugin User Guide</a>，我们在其中通过<code>project.hasProperty</code>读取项目中的配置，并将其动态的赋值给<code>signingConfigs.release</code>下的相关属性。</p>
<p>然后我们通过在<code>gradle.properties</code>或者其它项目中能够被gradle的文件中定义以上属性并赋值即可：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">storeFile=.<span class="regexp">/keystore/</span>test.keystore</div><div class="line">storePassword=android</div><div class="line">keyAlias=test</div><div class="line">keyPassword=android</div></pre></td></tr></table></figure>
<p>这样我们在项目团队协作时，将<code>gradle.properties</code>文件忽略即可。</p>
<p>Enjoy IT!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Android应用开发的时候会经常使用到第三方SDK，例如地图、推送、支付以及分享等。而这些第三方服务SDK为了应用不被滥用都会有签名验证机制。我们通过上传Android应用的签名来在服务端配置以验证应用的合法性。本文将讲述下在Android Stduio中常用的签名操作。&lt;/p&gt;
&lt;h3 id=&quot;默认KeyStore&quot;&gt;&lt;a href=&quot;#默认KeyStore&quot; class=&quot;headerlink&quot; title=&quot;默认KeyStore&quot;&gt;&lt;/a&gt;默认KeyStore&lt;/h3&gt;&lt;h4 id=&quot;默认KeyStore存储路径&quot;&gt;&lt;a href=&quot;#默认KeyStore存储路径&quot; class=&quot;headerlink&quot; title=&quot;默认KeyStore存储路径&quot;&gt;&lt;/a&gt;默认KeyStore存储路径&lt;/h4&gt;&lt;p&gt;在Android Stduio中系统默认内置了一个签名文件&lt;code&gt;debug.keystore&lt;/code&gt;，用于我们在debug下的默认App签名。如果没有在Gradle文件中特殊指定，那么Android Studio将自动使用默认的&lt;code&gt;debug.keystore&lt;/code&gt;文件为项目App生成Debug版本的签名。&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://notes.wanghao.work/categories/Android/"/>
    
    
      <category term="Android" scheme="https://notes.wanghao.work/tags/Android/"/>
    
      <category term="Android Studio" scheme="https://notes.wanghao.work/tags/Android-Studio/"/>
    
      <category term="KeyStore" scheme="https://notes.wanghao.work/tags/KeyStore/"/>
    
  </entry>
  
  <entry>
    <title>RxJava、Retrofit接收Error Response Body</title>
    <link href="https://notes.wanghao.work/2016-07-02-RxJava%E9%85%8D%E5%90%88Retofit%E6%8E%A5%E6%94%B6%E9%94%99%E8%AF%AFbody.html"/>
    <id>https://notes.wanghao.work/2016-07-02-RxJava配合Retofit接收错误body.html</id>
    <published>2016-07-02T14:10:53.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>RxJava</code>配合<code>Retrofit</code>能够大大简化Android项目中的网络请求代码量，使得逻辑更清晰，当然也可能会遇到一些问题。下面给出一种问题的解决方案。</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>一个基本的RxJava配合Retrofit以及Lambda的网络调用看起来像这个样子的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Subscription subscription = mApi.getSimpleApi()</div><div class="line">       .subscribeOn(Schedulers.io())</div><div class="line">       .observeOn(AndroidSchedulers.mainThread())</div><div class="line">       .subscribe(response -&gt; &#123;</div><div class="line"></div><div class="line">        <span class="comment">//do Something</span></div><div class="line"></div><div class="line">       &#125;, throwable -&gt; &#123;</div><div class="line"></div><div class="line">       <span class="comment">//Ops Error</span></div><div class="line"></div><div class="line">       &#125;);</div></pre></td></tr></table></figure>
<p>当<code>Retrofit</code>中的网络请求返回码状态码为<code>200</code>时，执行<code>do Something</code>中的逻辑处理正常的<br>业务流程，但是当服务器返回状态码为<code>非200</code>时，将会执行<code>Ops Error</code>中的业务流程而不会<br>执行<code>do Something</code>中的业务逻辑。</p>
<a id="more"></a>
<p>这样本没有什么问题，一般我们会在错误处理逻辑中在UI中给出错误提示，像这样:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Log.e(<span class="string">"Ops"</span>, <span class="string">"Error:"</span> + throwable.getMessage());</div></pre></td></tr></table></figure>
<p>但是这样的话我们只能获取到一服务器的错误响应码以及对应的简短的响应码错误说明，一般情况下我们服务器<br>都会包装错误信息为一个JSON，客户端解析错误信息必要的时候动态展示在UI上以提示用户。如果我们要拿到这样的JSON，使用<code>throwable.getMessage()</code>这样做显然是不行的。是不是使用RxJava配合Retrofit只能拿到这样的错误Throwable信息呢？</p>
<p>显然不是的，其实服务器返回的错误信息<code>非200</code>响应码的<code>Response Body</code>JSON对象包含在这个<code>throwable</code>对象中，我们可以这样将其解析出来:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">throwable -&gt; &#123;</div><div class="line">          <span class="keyword">if</span>(throwable <span class="keyword">instanceof</span> HttpException)&#123;</div><div class="line">            HttpException httpException= (HttpException) throwable;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">              String errorBody= httpException.response().errorBody().string();</div><div class="line"></div><div class="line">		<span class="comment">//<span class="doctag">TODO:</span> parse To JSON Obj</span></div><div class="line"></div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">              e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">	 <span class="comment">//Ops Print throwable</span></div><div class="line"></div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>在<code>Parse to JSON Obj</code>中将<code>errorBody</code>解析为JSON对象进行相应的处理即可。</p>
<p>然而，你不能让我每个地方都加上这样的一段代码吧，既然我们使用的是<code>RxJava</code>，我们可以让这种处理稍微看起来优雅点。以下以<code>Jackson</code>为例:</p>
<h4 id="自定义Action1"><a href="#自定义Action1" class="headerlink" title="自定义Action1"></a>自定义Action1</h4><p>由于<code>RxJava</code>的错误异常处理接受一个参数，并且没有返回值，因此我们可以定义一个<code>Action1</code>来替代默认的Error Action:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorAction</span> <span class="keyword">implements</span> <span class="title">Action1</span>&lt;<span class="title">Throwable</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">    call(ErrorMessage.handle(throwable));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(ErrorMessage error)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中<code>ErrorMessage</code>为我们定义好的错误消息Model:</p>
<h4 id="定义Throwable-Handle"><a href="#定义Throwable-Handle" class="headerlink" title="定义Throwable Handle"></a>定义Throwable Handle</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JsonIgnoreProperties</span>(ignoreUnknown = <span class="keyword">true</span>) <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseError</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ERROR_CODE_IO_ERROR = <span class="number">2072</span>;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ERROR_CODE_UN_KNOW = <span class="number">2073</span>;</div><div class="line">  <span class="meta">@JsonProperty</span>(<span class="string">"status_code"</span>) <span class="keyword">public</span> <span class="keyword">int</span> statusCode;</div><div class="line">  <span class="keyword">public</span> String message;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatusCode</span><span class="params">(<span class="keyword">int</span> statusCode)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.statusCode = statusCode;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.message = message;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ResponseError <span class="title">handle</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">    ResponseError responseError = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (throwable <span class="keyword">instanceof</span> HttpException) &#123;</div><div class="line">      HttpException exception = (HttpException) throwable;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        responseError = <span class="keyword">new</span> ObjectMapper().readValue(exception.response().errorBody().string(),</div><div class="line">            ResponseError.class);</div><div class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">        responseError = <span class="keyword">new</span> ResponseError();</div><div class="line">        responseError.setMessage(e.getLocalizedMessage());</div><div class="line">        responseError.setStatusCode(ERROR_CODE_IO_ERROR);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      responseError = <span class="keyword">new</span> ResponseError();</div><div class="line">      responseError.setMessage(throwable.getMessage());</div><div class="line">      responseError.setStatusCode(ERROR_CODE_UN_KNOW);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> responseError;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样，我们就完成了一个自定义<code>Action1</code>了，接下来我们便可以这样使用了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Subscription subscription = mApi.getSimpleApi()</div><div class="line">        .subscribeOn(Schedulers.io())</div><div class="line">        .observeOn(AndroidSchedulers.mainThread())</div><div class="line">        .subscribe(response -&gt; &#123;</div><div class="line"></div><div class="line">         <span class="comment">//do Something</span></div><div class="line"></div><div class="line">        &#125;,  <span class="keyword">new</span> ErrorAction() &#123;</div><div class="line">              <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(ErrorMessage msg)</span> </span>&#123;</div><div class="line">			<span class="comment">//Do Error               </span></div><div class="line"></div><div class="line">              &#125;</div><div class="line">            &#125;);</div></pre></td></tr></table></figure>
<p>其中在<code>Do Error</code>中拿到<code>ErrorMessage</code>对象，进行相应的对象操作即可~</p>
<p>Enjoy IT!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;RxJava&lt;/code&gt;配合&lt;code&gt;Retrofit&lt;/code&gt;能够大大简化Android项目中的网络请求代码量，使得逻辑更清晰，当然也可能会遇到一些问题。下面给出一种问题的解决方案。&lt;/p&gt;
&lt;h3 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h3&gt;&lt;p&gt;一个基本的RxJava配合Retrofit以及Lambda的网络调用看起来像这个样子的:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Subscription subscription = mApi.getSimpleApi()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       .subscribeOn(Schedulers.io())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       .observeOn(AndroidSchedulers.mainThread())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       .subscribe(response -&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//do Something&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &amp;#125;, throwable -&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;//Ops Error&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当&lt;code&gt;Retrofit&lt;/code&gt;中的网络请求返回码状态码为&lt;code&gt;200&lt;/code&gt;时，执行&lt;code&gt;do Something&lt;/code&gt;中的逻辑处理正常的&lt;br&gt;业务流程，但是当服务器返回状态码为&lt;code&gt;非200&lt;/code&gt;时，将会执行&lt;code&gt;Ops Error&lt;/code&gt;中的业务流程而不会&lt;br&gt;执行&lt;code&gt;do Something&lt;/code&gt;中的业务逻辑。&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://notes.wanghao.work/categories/Android/"/>
    
    
      <category term="Android" scheme="https://notes.wanghao.work/tags/Android/"/>
    
      <category term="Android Studio" scheme="https://notes.wanghao.work/tags/Android-Studio/"/>
    
      <category term="RxJava" scheme="https://notes.wanghao.work/tags/RxJava/"/>
    
      <category term="Retrofit" scheme="https://notes.wanghao.work/tags/Retrofit/"/>
    
  </entry>
  
  <entry>
    <title>为NexT主题添加文章阅读量统计功能</title>
    <link href="https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html"/>
    <id>https://notes.wanghao.work/2015-10-21-为NexT主题添加文章阅读量统计功能.html</id>
    <published>2015-10-21T13:57:00.000Z</published>
    <updated>2016-11-14T13:34:22.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><hr>
<p>由于最近在折腾Android项目，需要用到一些与服务器交互、以及数据存储的相关功能，然后发现了<a href="https://leancloud.cn" target="_blank" rel="external">LeanCloud</a>这家服务提供商,使用下来还感觉还挺靠谱的(请给我广告费)。正好发现他们服务提供了<a href="https://leancloud.cn/docs/js_guide.html" target="_blank" rel="external">JavaScript SDK</a>，于是就想着尝试着实现Hexo博客文章的浏览数统计功能，之前虽然在使用不蒜子，但是不蒜子不能够在主页展示文章阅读量啊！对于博主这种有强迫症又想装X的人来说果断不能忍啊！</p>
<h3 id="修改NexT主题模版"><a href="#修改NexT主题模版" class="headerlink" title="修改NexT主题模版"></a><del>修改NexT主题模版</del></h3><p><del>本方法理论上对Hexo博客通用，由于博主使用的是NexT主题，所以当然针对NexT来说咯。</del><strong><font color="red">NexT主题目前已经合并这个Feature，因此如果你使用的是NexT主题，可以直接使用不用修改主题模版而直接在<code>_config.yml</code>中配置即可，请直接跳转查看<a href="#%E9%85%8D%E7%BD%AELeanCloud">配置LeanCloud</a></font></strong></p>
<a id="more"></a>
<h4 id="修改-config-yml文件"><a href="#修改-config-yml文件" class="headerlink" title="修改_config.yml文件"></a><del>修改<code>_config.yml</code>文件</del></h4><p><del>打开NexT主题的根目录下的<code>_config.yml</code>文件，在任意位置添加以下内容：</del></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">leancloud_visitors:</div><div class="line">  enable: true</div><div class="line">  app_id: #&lt;AppID&gt;</div><div class="line">  app_key: #&lt;AppKEY&gt;</div></pre></td></tr></table></figure>
<h4 id="添加lean-analytics-swig文件"><a href="#添加lean-analytics-swig文件" class="headerlink" title="添加lean-analytics.swig文件"></a><del>添加<code>lean-analytics.swig</code>文件</del></h4><p><del>在主题的<code>layout\_scripts</code>路径下，新建一个<code>lean-analytics.swig</code>文件，并向里面添加以下内容</del></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">&lt;!-- custom analytics part create by xiamo --&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script&gt;AV.initialize(<span class="string">"&#123;&#123;theme.leancloud_visitors.app_id&#125;&#125;"</span>, <span class="string">"&#123;&#123;theme.leancloud_visitors.app_key&#125;&#125;"</span>);<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script&gt;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showTime</span>(<span class="params">Counter</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> query = <span class="keyword">new</span> AV.Query(Counter);</div><div class="line">	$(<span class="string">".leancloud_visitors"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> url = $(<span class="keyword">this</span>).attr(<span class="string">"id"</span>).trim();</div><div class="line">		query.equalTo(<span class="string">"url"</span>, url);</div><div class="line">		query.find(&#123;</div><div class="line">			<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</div><div class="line">				<span class="keyword">if</span> (results.length == <span class="number">0</span>) &#123;</div><div class="line">					<span class="keyword">var</span> content = $(<span class="built_in">document</span>.getElementById(url)).text() + <span class="string">': 0'</span>;</div><div class="line">					$(<span class="built_in">document</span>.getElementById(url)).text(content);</div><div class="line">					<span class="keyword">return</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; results.length; i++) &#123;</div><div class="line">					<span class="keyword">var</span> object = results[i];</div><div class="line">					<span class="keyword">var</span> content = $(<span class="built_in">document</span>.getElementById(url)).text() + <span class="string">': '</span> + object.get(<span class="string">'time'</span>);</div><div class="line">					$(<span class="built_in">document</span>.getElementById(url)).text(content);</div><div class="line">				&#125;</div><div class="line">			&#125;,</div><div class="line">			<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">object, error</span>) </span>&#123;</div><div class="line">				<span class="built_in">console</span>.log(<span class="string">"Error: "</span> + error.code + <span class="string">" "</span> + error.message);</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">	&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params">Counter</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> Counter = AV.Object.extend(<span class="string">"Counter"</span>);</div><div class="line">	url = $(<span class="string">".leancloud_visitors"</span>).attr(<span class="string">'id'</span>).trim();</div><div class="line">	title = $(<span class="string">".leancloud_visitors"</span>).attr(<span class="string">'data-flag-title'</span>).trim();</div><div class="line">	<span class="keyword">var</span> query = <span class="keyword">new</span> AV.Query(Counter);</div><div class="line">	query.equalTo(<span class="string">"url"</span>, url);</div><div class="line">	query.find(&#123;</div><div class="line">		<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</div><div class="line">				<span class="keyword">var</span> counter = results[<span class="number">0</span>];</div><div class="line">				counter.fetchWhenSave(<span class="literal">true</span>);</div><div class="line">				counter.increment(<span class="string">"time"</span>);</div><div class="line">				counter.save(<span class="literal">null</span>, &#123;</div><div class="line">					<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">counter</span>) </span>&#123;</div><div class="line">						<span class="keyword">var</span> content = $(<span class="built_in">document</span>.getElementById(url)).text() + <span class="string">': '</span> + counter.get(<span class="string">'time'</span>);</div><div class="line">						$(<span class="built_in">document</span>.getElementById(url)).text(content);</div><div class="line">					&#125;,</div><div class="line">					<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">counter, error</span>) </span>&#123;</div><div class="line">						<span class="built_in">console</span>.log(<span class="string">'Failed to save Visitor num, with error message: '</span> + error.message);</div><div class="line">					&#125;</div><div class="line">				&#125;);</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				<span class="keyword">var</span> newcounter = <span class="keyword">new</span> Counter();</div><div class="line">				newcounter.set(<span class="string">"title"</span>, title);</div><div class="line">				newcounter.set(<span class="string">"url"</span>, url);</div><div class="line">				newcounter.set(<span class="string">"time"</span>, <span class="number">1</span>);</div><div class="line">				newcounter.save(<span class="literal">null</span>, &#123;</div><div class="line">					<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newcounter</span>) </span>&#123;</div><div class="line">					    <span class="built_in">console</span>.log(<span class="string">"newcounter.get('time')="</span>+newcounter.get(<span class="string">'time'</span>));</div><div class="line">						<span class="keyword">var</span> content = $(<span class="built_in">document</span>.getElementById(url)).text() + <span class="string">': '</span> + newcounter.get(<span class="string">'time'</span>);</div><div class="line">						$(<span class="built_in">document</span>.getElementById(url)).text(content);</div><div class="line">					&#125;,</div><div class="line">					<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newcounter, error</span>) </span>&#123;</div><div class="line">						<span class="built_in">console</span>.log(<span class="string">'Failed to create'</span>);</div><div class="line">					&#125;</div><div class="line">				&#125;);</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">			<span class="built_in">console</span>.log(<span class="string">'Error:'</span> + error.code + <span class="string">" "</span> + error.message);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">&#125;</div><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> Counter = AV.Object.extend(<span class="string">"Counter"</span>);</div><div class="line">	<span class="keyword">if</span> ($(<span class="string">'.leancloud_visitors'</span>).length == <span class="number">1</span>) &#123;</div><div class="line">		addCount(Counter);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ($(<span class="string">'.post-title-link'</span>).length &gt; <span class="number">1</span>) &#123;</div><div class="line">		showTime(Counter);</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="修改post-swig文件"><a href="#修改post-swig文件" class="headerlink" title="修改post.swig文件"></a><del>修改<code>post.swig</code>文件</del></h4><p><del>在主题的<code>layout\_macro</code>路径下，打开<code>post.swig</code>文件，找到以下内容（大概88行）：</del></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;% if not is_index and theme.facebook_sdk.enable and theme.facebook_sdk.like_button %&#125;</div><div class="line">  &amp;nbsp; | &amp;nbsp;</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fb-like"</span> <span class="attr">data-layout</span>=<span class="string">"button_count"</span> <span class="attr">data-share</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<p><del>在其后面添加如下内容：</del></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">		  	 <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"&#123;&#123; url_for(post.path) &#125;&#125;"</span><span class="attr">class</span>=<span class="string">"leancloud_visitors"</span>  <span class="attr">data-flag-title</span>=<span class="string">"&#123;&#123; post.title &#125;&#125;"</span>&gt;</span></div><div class="line">            &amp;nbsp; | &amp;nbsp; &#123;&#123;__('post.visitors')&#125;&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		  &#123;% endif %&#125;</div></pre></td></tr></table></figure>
<p><del>添加完毕之后，文件内容像这个样子：</del></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">      &#123;% if not is_index and theme.facebook_sdk.enable and theme.facebook_sdk.like_button %&#125;</div><div class="line">        &amp;nbsp; | &amp;nbsp;</div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fb-like"</span> <span class="attr">data-layout</span>=<span class="string">"button_count"</span> <span class="attr">data-share</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      &#123;% endif %&#125;</div><div class="line">&#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">	 <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"&#123;&#123; url_for(post.path) &#125;&#125;"</span><span class="attr">class</span>=<span class="string">"leancloud_visitors"</span>  <span class="attr">data-flag-title</span>=<span class="string">"&#123;&#123; post.title &#125;&#125;"</span>&gt;</span></div><div class="line">        &amp;nbsp; | &amp;nbsp; &#123;&#123;__('post.visitors')&#125;&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">&#123;% endif %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<h4 id="修改layout-swig文件"><a href="#修改layout-swig文件" class="headerlink" title="修改layout.swig文件"></a><del>修改<code>layout.swig</code>文件</del></h4><p><del>在NexT根目录的<code>layout</code>路径下，打开 <code>_layout.swig</code>文件，在<code>&lt;/body&gt;</code>上方添加如下内容：</del><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">  	 &#123;% include '_scripts/lean-analytics.swig' %&#125;</div><div class="line">  &#123;%  endif %&#125;</div></pre></td></tr></table></figure></p>
<p><del>添加完成之后，文件内容像这个样子：</del></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;# LazyLoad #&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for(theme.js) &#125;&#125;/lazyload.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      $(<span class="string">"#posts"</span>).find(<span class="string">'img'</span>).lazyload(&#123;</div><div class="line">        <span class="attr">placeholder</span>: <span class="string">"&#123;&#123; url_for(theme.images) &#125;&#125;/loading.gif"</span>,</div><div class="line">        <span class="attr">effect</span>: <span class="string">"fadeIn"</span></div><div class="line">      &#125;);</div><div class="line">    &#125;);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  &#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">  	 &#123;% include '_scripts/lean-analytics.swig' %&#125;</div><div class="line">  &#123;%  endif %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="修改zh-Hans-yml文件"><a href="#修改zh-Hans-yml文件" class="headerlink" title="修改zh-Hans.yml文件"></a><del>修改<code>zh-Hans.yml</code>文件</del></h4><p><del>在NexT目录的<code>languages</code>路径下的<code>zh-Hans.yml</code>文件，在<code>post:</code>结点下添加<code>visitors: 阅读次数</code>，像这个样子：</del><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">post:</div><div class="line">  posted: 发表于</div><div class="line">  visitors: 阅读次数</div><div class="line">  updated: 更新于</div><div class="line">  in: 分类于</div><div class="line">  read_more: 阅读全文</div><div class="line">  untitled: 未命名</div><div class="line">  toc_empty: 此文章未包含目录</div></pre></td></tr></table></figure></p>
<p><del><strong> 如果你使用的是其它NexT的语言，请相应的添加该字段即可。</strong></del></p>
<p><del>至此NexT的修改工作就完成了，但是现在还是不能够使用文章阅读量这个统计功能的。这个功能依赖于<a href="https://leancloud.cn/" target="_blank" rel="external">LeanCloud</a>提供后端数据存取，因此我们需要注册一个<a href="https://leancloud.cn/login.html#/signup" target="_blank" rel="external">LeanCloud帐号</a>才能继续使用这个功能，<strong><a href="https://leancloud.cn/login.html#/signup" target="_blank" rel="external">点我快速注册</a>.</strong></del></p>
<hr>
<h3 id="配置LeanCloud"><a href="#配置LeanCloud" class="headerlink" title="配置LeanCloud"></a>配置<a href="https://leancloud.cn" target="_blank" rel="external">LeanCloud</a></h3><p>在注册完成LeanCloud帐号并验证邮箱之后，我们就可以登录我们的LeanCloud帐号，进行一番配置之后拿到<code>AppID</code>以及<code>AppKey</code>这两个参数即可正常使用文章阅读量统计的功能了。</p>
<h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><ul>
<li>我们新建一个应用来专门进行博客的访问统计的数据操作。首先，打开控制台，如下图所示：</li>
</ul>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/open_consoloe.png" alt="" title="打开控制台"></p>
<ul>
<li>在出现的界面点击<code>创建应用</code>：</li>
</ul>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/create_app.png" alt="" title="创建应用"></p>
<ul>
<li>在接下来的页面，新建的应用名称我们可以随意输入，即便是输入的不满意我们后续也是可以更改的:</li>
</ul>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/creating_app.png" alt="" title="创建的新应用名称"></p>
<ul>
<li>这里为了演示的方便，我新创建一个取名为test的应用。创建完成之后我们点击新创建的应用的名字来进行该应用的参数配置：</li>
</ul>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/create_class.png" alt="" title="打开应用参数配置界面"></p>
<ul>
<li>在应用的数据配置界面，左侧下划线开头的都是系统预定义好的表，为了便于区分我们新建一张表来保存我们的数据。点击左侧右上角的齿轮图标，新建Class：<br> 在弹出的选项中选择<code>创建Class</code>来新建Class用来专门保存我们博客的文章访问量等数据:<br> 点击<code>创建Class</code>之后，<del>理论上来说名字可以随意取名，只要你交互代码做相应的更改即可</del>，但是为了保证我们前面对NexT主题的修改兼容，此处的<strong><font color="green">新建Class名字必须为<font color="red"><code>Counter</code></font></font></strong>:</li>
</ul>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/creating_class.png" alt="" title="权限配置"></p>
<ul>
<li>由于LeanCloud升级了默认的ACL权限，如果你想避免后续因为权限的问题导致次数统计显示不正常，建议在此处选择<code>无限制</code>。</li>
</ul>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/open_app_key.png" alt="" title="打开应用设置"></p>
<p>创建完成之后，左侧数据栏应该会多出一栏名为<code>Counter</code>的栏目，这个时候我们点击顶部的设置，切换到test应用的操作界面:<br>在弹出的界面中，选择左侧的<code>应用Key</code>选项，即可发现我们创建应用的<code>AppID</code>以及<code>AppKey</code>，有了它，我们就有权限能够通过主题中配置好的Javascript代码与这个应用的Counter表进行数据存取操作了:</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/opened_app_key.png" alt="" title="获取Appid、Appkey"></p>
<p>复制<code>AppID</code>以及<code>AppKey</code>并在NexT主题的<code>_config.yml</code>文件中我们相应的位置填入即可，正确配置之后文件内容像这个样子:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">leancloud_visitors:</div><div class="line">  enable: true</div><div class="line">  app_id: joaeuuc4hsqudUUwx4gIvGF6-gzGzoHsz</div><div class="line">  app_key: E9UJsJpw1omCHuS22PdSpKoh</div></pre></td></tr></table></figure>
<p>这个时候重新生成部署Hexo博客，应该就可以正常使用文章阅读量统计的功能了。需要特别说明的是：记录文章访问量的唯一标识符是文章的<code>发布日期</code>以及<code>文章的标题</code>，因此请确保这两个数值组合的唯一性，如果你更改了这两个数值，会造成文章阅读数值的清零重计。</p>
<p>###后台管理</p>
<p>当你配置部分完成之后，初始的文章统计量显示为0，但是这个时候我们LeanCloud对应的应用的<code>Counter</code>表中并没有相应的记录，只是单纯的显示为0而已，当博客文章在配置好阅读量统计服务之后第一次打开时，便会自动向服务器发送数据来创建一条数据，该数据会被记录在对应的应用的<code>Counter</code>表中。</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/background.png" alt="" title="后台管理"></p>
<p>我们可以修改其中的<code>time</code>字段的数值来达到修改某一篇文章的访问量的目的（博客文章访问量快递提升人气的装逼利器）。双击具体的数值，修改之后回车即可保存。</p>
<ul>
<li><code>url</code>字段被当作唯一<code>ID</code>来使用，因此如果你不知道带来的后果的话请不要修改。</li>
<li><code>title</code>字段显示的是博客文章的标题，用于后台管理的时候区分文章之用，没有什么实际作用。</li>
<li>其他字段皆为自动生成，具体作用请查阅LeanCloud官方文档，如果你不知道有什么作用请不要随意修改。</li>
</ul>
<p>###Web安全</p>
<p>因为AppID以及AppKey是暴露在外的，因此如果一些别用用心之人知道了之后用于其它目的是得不偿失的，为了确保只用于我们自己的博客，建议开启Web安全选项，这样就只能通过我们自己的域名才有权访问后台的数据了，可以进一步提升安全性。</p>
<p>选择应用的设置的<code>安全中心</code>选项卡:</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/open_safe_center.png" alt="" title="进入安全中心"></p>
<p>在<code>Web 安全域名</code>中填入我们自己的博客域名，来确保数据调用的安全:</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/bind_domain.png" alt="" title="锁定域名"></p>
<p>如果你不知道怎么填写安全域名而或者填写完成之后发现博客文章访问量显示不正常，打开浏览器调试模式，发现如下图的输出:</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/static/images/leancloud-page-anlysis/broswer_403.png" alt="" title="Web安全域名填写错误"></p>
<p>这说明你的安全域名填写错误，导致服务器拒绝了数据交互的请求，你可以更改为正确的安全域名或者你不知道如何修改请在本博文中留言或者放弃设置Web安全域名。</p>
<p>Enjoy it！</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;由于最近在折腾Android项目，需要用到一些与服务器交互、以及数据存储的相关功能，然后发现了&lt;a href=&quot;https://leancloud.cn&quot;&gt;LeanCloud&lt;/a&gt;这家服务提供商,使用下来还感觉还挺靠谱的(请给我广告费)。正好发现他们服务提供了&lt;a href=&quot;https://leancloud.cn/docs/js_guide.html&quot;&gt;JavaScript SDK&lt;/a&gt;，于是就想着尝试着实现Hexo博客文章的浏览数统计功能，之前虽然在使用不蒜子，但是不蒜子不能够在主页展示文章阅读量啊！对于博主这种有强迫症又想装X的人来说果断不能忍啊！&lt;/p&gt;
&lt;h3 id=&quot;修改NexT主题模版&quot;&gt;&lt;a href=&quot;#修改NexT主题模版&quot; class=&quot;headerlink&quot; title=&quot;修改NexT主题模版&quot;&gt;&lt;/a&gt;&lt;del&gt;修改NexT主题模版&lt;/del&gt;&lt;/h3&gt;&lt;p&gt;&lt;del&gt;本方法理论上对Hexo博客通用，由于博主使用的是NexT主题，所以当然针对NexT来说咯。&lt;/del&gt;&lt;strong&gt;&lt;font color=red&gt;NexT主题目前已经合并这个Feature，因此如果你使用的是NexT主题，可以直接使用不用修改主题模版而直接在&lt;code&gt;_config.yml&lt;/code&gt;中配置即可，请直接跳转查看&lt;a href=&quot;#%E9%85%8D%E7%BD%AELeanCloud&quot;&gt;配置LeanCloud&lt;/a&gt;&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Hexo" scheme="https://notes.wanghao.work/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://notes.wanghao.work/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>Create a Simple Android Keyboard</title>
    <link href="https://notes.wanghao.work/2015-09-04-Create-a-Simple-Android-Keyboard.html"/>
    <id>https://notes.wanghao.work/2015-09-04-Create-a-Simple-Android-Keyboard.html</id>
    <published>2015-09-04T07:12:11.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>##前言</p>
<p>&emsp;&emsp;由于最近做的一个Android项目需要用到用户的输入一些字符，常规的输入法输入非常的不方便。因此有必要自定义一个输入法来完成这个过程。此处给出一个简单的输入法Demo<br>来帮助理解自定义输入法的一些实现过程。</p>
<ul>
<li><strong>有关输入法的一些说明，请参见:<a href="http://notes.xiamo.tk/2015-04-01-Create-an-Android-IME.html" target="_blank" rel="external">Create a Android IME</a></strong></li>
</ul>
<a id="more"></a>
<p>##准备工作</p>
<p>&emsp;&emsp;磨刀不误砍柴工，创建一个Android是需要一点点准备工作的,选择一个好的IDE能够提高我们编码的效率：</p>
<ul>
<li>Android Studio（推荐）</li>
<li>Android SDK</li>
</ul>
<p>本博文的编写环境为Android Studio，如果你还在使用Eclipse的话，转到Android Studio上来吧！如果对上述IDE的下载感到茫然的话，推荐一个国内Android开发的好网站：<a href="http://www.androiddevtools.cn/" target="_blank" rel="external">http://www.androiddevtools.cn</a>。</p>
<p>##创建一个Android项目</p>
<ul>
<li>打开Android Studio，创建一个新的Android项目，命名为<code>SimpleKeyboard</code>，如下图：</li>
</ul>
<p><img src="http://i3.piimg.com/37ae2bfdf945c18e.png" alt="" title="创建一个SimpleKeyboard项目"></p>
<ul>
<li>最小的Android支持版本我们在这里选择API 9也就是Android 2.3咯：</li>
</ul>
<p><img src="http://i3.piimg.com/f337c436d68dcc22.png" alt="" title="设置最小SDK支持版本"></p>
<ul>
<li>由于我们只是一个单独的键盘Demo，为了达到极致精简，还是不需要Activity了，因此我们选择<code>Add No Activity</code>：</li>
</ul>
<p><img src="http://i3.piimg.com/fed92e215ec17e4f.png" alt="" title="选择Add No Activity"></p>
<p>点击Finish，这样就完成了我们Android Keyboard项目的创建了。这个等待Gradle构建完成，因为我们这个项目是没有Activity的，因此我们需要按照如下图稍微配置一下：</p>
<p><img src="http://i3.piimg.com/4c72f6d152c54dee.png" alt=""></p>
<p><img src="http://i3.piimg.com/2195d3987d5dddd1.png" alt=""></p>
<p>##编辑AndroidManifest.xml文件</p>
<p>&emsp;&emsp;键盘在Android系统中被识别为一个输入法编辑器（IME），IME作为一个Service运行。只有在AndroidManifest.xml文件中通过<code>android.permission.BIND_INPUT_METHOD</code>权限声明的Service并且响应<code>android.view.im</code>这个元数据动作才能够被Android系统正确的识别为IME。因此，我们在<code>AndroidManifest.xml</code>文件中的application标签对中添加如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">service</span></span></div><div class="line">          <span class="attr">android:name</span>=<span class="string">".SimpleIME"</span></div><div class="line">          <span class="attr">android:label</span>=<span class="string">"@string/custom_ime"</span></div><div class="line">          <span class="attr">android:permission</span>=<span class="string">"android.permission.BIND_INPUT_METHOD"</span>&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line">              <span class="attr">android:name</span>=<span class="string">"android.view.im"</span></div><div class="line">              <span class="attr">android:resource</span>=<span class="string">"@xml/method"</span> /&gt;</div><div class="line">          <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.view.InputMethod"</span> /&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">service</span>&gt;</span></div></pre></td></tr></table></figure>
<p>##创建method.xml</p>
<blockquote>
<p>&emsp;&emsp;在上面的Service声明中，meta-data标签声明引用了一个叫做<code>method.xml</code>的文件，如果没有这个文件，那么Android系统将不能够识别我们的Service为一个有效的IME Service。这个文件包含了有关输入法及其子类的详细信息。</p>
</blockquote>
<p>在我们的Demo中，我们定义一个<code>subtyoe</code>来声明输入法的显示名称以及其语言环境：（如果没有res/xml目录的话，创建一个并将下面的内容添加到该目录的method.xml文件中）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">input-method</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">subtype</span></span></div><div class="line">        <span class="attr">android:imeSubtypeLocale</span>=<span class="string">"zh_CN"</span></div><div class="line">        <span class="attr">android:imeSubtypeMode</span>=<span class="string">"keyboard"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"tk_xiamo_notes"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">input-method</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如果你对label中直接写死字符串这种做法比较有强迫症的话，可以将其抽取到Strings.xml文件中。</p>
<p>##定义键盘布局</p>
<p>&emsp;&emsp;我们的键盘布局比较简单，仅仅包含了一个KeyboardView，因此在<code>layout</code>目录中创建一个<code>keyboard.xml</code>文件，并添加一下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.inputmethodservice.KeyboardView</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/keyboard"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:keyPreviewLayout</span>=<span class="string">"@layout/preview"</span> /&gt;</div></pre></td></tr></table></figure>
<p>其中需要说明的是：</p>
<ul>
<li><code>layout_alignParentBottom</code>属性设置为<code>true</code>来保证键盘会在设备屏幕的底端弹出而不是在其它什么地方弹出。</li>
<li><code>keyPreviewLayout</code>属性用于按下按键时暂短的按键预览。这里我们由于图方便省事，就用一个TextView来预览吧~</li>
</ul>
<p>在<code>layout</code>目录下创建一个preview.xml文件，并在其中添加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#A6A6A6"</span></div><div class="line">    <span class="attr">android:textStyle</span>=<span class="string">"bold"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"30sp"</span></div><div class="line">    &gt;</div><div class="line"><span class="tag">&lt;/<span class="name">TextView</span>&gt;</span></div></pre></td></tr></table></figure>
<p>##定义键盘按键</p>
<blockquote>
<p>键盘按键所代表的键值以及其位置等详细信息都被指定在一个xml文件中，每个独立的键盘按键至少都必须包含一下两个属性：</p>
</blockquote>
<table>
<thead>
<tr>
<th>属性名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>keyLabel</td>
<td>决定这个按键上显示的字符信息</td>
</tr>
<tr>
<td>codes</td>
<td>决定这个按键的对应的字符信息所代表的键值</td>
</tr>
</tbody>
</table>
<p><strong>例如：定义一个字母A的按键那么它的<code>codes</code>属性值应该为：97，<code>keyLabel</code>属性值应该为A。</strong></p>
<p>如果一个按键关联了多个键值，那么点击该按键输出的字符依赖于敲击该按键的次数。</p>
<p><strong>例如：如果一个按键拥有三个键值：63、33、58:</strong></p>
<table>
<thead>
<tr>
<th>敲击该按键的次数</th>
<th>输出的字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>1次</td>
<td>?</td>
</tr>
<tr>
<td>2次</td>
<td>!</td>
</tr>
<tr>
<td>3次</td>
<td>:</td>
</tr>
</tbody>
</table>
<p>当然了，除了上述属性之外，一个按键还有一些其他的属性：</p>
<table>
<thead>
<tr>
<th>属性名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>keyEdgeFlags</td>
<td>可以设置的值有：right或者left，该属性通常用在一行最左边或者最右边的按键上用于表示按键的排布</td>
</tr>
<tr>
<td>keyWidth</td>
<td>定义一个按键的宽度，通常该宽度值被定义为一个百分比值</td>
</tr>
<tr>
<td>isRepeatable</td>
<td>如果这个属性被设置为true的话，长按被设置为该属性的按键将会在长按这段时间中多次重复该按键的动作。通过，在删除键或者空格键中设置该属性为true</td>
</tr>
</tbody>
</table>
<p>键盘上的按键通过Row标识为一组按键，比较推荐的做法是限制每组中最多10枚按键，这样的话，每个按键的宽度等于键盘宽度的10%。在本Demo中，按键高度被设置为60dp，这个数值可以任意调整。但是推荐不要低于48dp。</p>
<p>在<code>res/xml</code>目录中，创建一个<code>qwerty.xml</code>文件，并添加以下内容完成按键的定义：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">Keyboard</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:horizontalGap</span>=<span class="string">"0px"</span></div><div class="line">    <span class="attr">android:keyHeight</span>=<span class="string">"60dp"</span></div><div class="line">    <span class="attr">android:keyWidth</span>=<span class="string">"10%p"</span></div><div class="line">    <span class="attr">android:verticalGap</span>=<span class="string">"0px"</span></div><div class="line">    &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Row</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"49"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"left"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"1"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"50"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"2"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"51"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"3"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"52"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"4"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"53"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"5"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"54"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"6"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"55"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"7"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"56"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"8"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"57"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"9"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"48"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"right"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"0"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Row</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"113"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"left"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"q"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"119"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"w"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"101"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"e"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"114"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"r"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"116"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"t"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"121"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"y"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"117"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"u"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"105"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"i"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"111"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"o"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"112"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"right"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"p"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Row</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"97"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"left"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"a"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"115"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"s"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"100"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"d"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"102"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"f"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"103"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"g"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"104"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"h"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"106"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"j"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"107"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"k"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"108"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"l"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"35,64"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"right"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"\#\@"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Row</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"-1"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"left"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"↑"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"122"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"z"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"120"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"x"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"99"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"c"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"118"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"v"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"98"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"b"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"110"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"n"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"109"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"m"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"46"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"."</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"63,33,58"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"right"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"\?!:"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Row</span> <span class="attr">android:rowEdgeFlags</span>=<span class="string">"bottom"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"44"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"left"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">","</span></div><div class="line">            <span class="attr">android:keyWidth</span>=<span class="string">"10%p"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"47"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"/"</span></div><div class="line">            <span class="attr">android:keyWidth</span>=<span class="string">"10%p"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"32"</span></div><div class="line">            <span class="attr">android:isRepeatable</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"SPACE"</span></div><div class="line">            <span class="attr">android:keyWidth</span>=<span class="string">"40%p"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"-5"</span></div><div class="line">            <span class="attr">android:isRepeatable</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"Del"</span></div><div class="line">            <span class="attr">android:keyWidth</span>=<span class="string">"20%p"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Key</span></span></div><div class="line">            <span class="attr">android:codes</span>=<span class="string">"-4"</span></div><div class="line">            <span class="attr">android:keyEdgeFlags</span>=<span class="string">"right"</span></div><div class="line">            <span class="attr">android:keyLabel</span>=<span class="string">"Done"</span></div><div class="line">            <span class="attr">android:keyWidth</span>=<span class="string">"20%p"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Keyboard</span>&gt;</span></div></pre></td></tr></table></figure>
<p>##创建Service类</p>
<p>创建一个java类，命名为<code>SimpleIME.java</code>（与AndroidManifest.xml文件中的定义向对应）：</p>
<ul>
<li><code>SimpleIME</code>类应该继承至<code>InputMethodService</code>类。</li>
<li><code>SimpleIME</code>类应该实现<code>OnKeyboardActionListener</code>接口，该接口包含了键盘被点击或者被按下时回调的一些函数。</li>
</ul>
<p>创建完成之后，将以下内容添加到该文件中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> tk.xiamo.notes.simplekeyboard;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.inputmethodservice.InputMethodService;</div><div class="line"><span class="keyword">import</span> android.inputmethodservice.Keyboard;</div><div class="line"><span class="keyword">import</span> android.inputmethodservice.KeyboardView;</div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.view.KeyEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.inputmethod.InputConnection;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleIME</span> <span class="keyword">extends</span> <span class="title">InputMethodService</span> <span class="keyword">implements</span> <span class="title">KeyboardView</span>.<span class="title">OnKeyboardActionListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> KeyboardView keyboardView;</div><div class="line">    <span class="keyword">private</span> Keyboard keyboard;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> caps = <span class="keyword">false</span>;<span class="comment">//大小写转换</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * onKey方法用于处理键盘与其他应用程序输入域进行交互。</div><div class="line">     * getCurrentInputConnection 这个方法被用于获取其它应用程序的输入域，一旦我们获取到这个Connection对象，我们就可以使用以下方法了：</div><div class="line">     * commitText ：输出一个或者多个字符到输入域中。</div><div class="line">     * deleteSurroundingText ：从输入域中删除一个或者多个字符。</div><div class="line">     * sendKeyEvent ：发送一个事件（如KEYCODE_ENTER）到外部的应用程序。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onKey</span><span class="params">(<span class="keyword">int</span> primaryCode, <span class="keyword">int</span>[] keyCodes)</span> </span>&#123;</div><div class="line">        InputConnection inputConnection = getCurrentInputConnection();</div><div class="line">        playClick(primaryCode);</div><div class="line">        <span class="keyword">switch</span> (primaryCode) &#123;</div><div class="line">            <span class="keyword">case</span> Keyboard.KEYCODE_DELETE:</div><div class="line">                inputConnection.deleteSurroundingText(<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Keyboard.KEYCODE_SHIFT:</div><div class="line">                caps = !caps;</div><div class="line">                keyboardView.setShifted(caps);</div><div class="line">                keyboardView.invalidateAllKeys();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Keyboard.KEYCODE_DONE:</div><div class="line">                inputConnection.sendKeyEvent(<span class="keyword">new</span> KeyEvent(KeyEvent.ACTION_DOWN, KeyEvent.KEYCODE_ENTER));</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">char</span> code = (<span class="keyword">char</span>) primaryCode;</div><div class="line">                <span class="keyword">if</span> (Character.isLetter(code) &amp;&amp; caps) &#123;</div><div class="line">                    code = Character.toUpperCase(code);</div><div class="line">                &#125;</div><div class="line">                inputConnection.commitText(String.valueOf(code), <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 当键盘被创建的时候，onCreateInputView方法将会被自动调用。所有的Service成员变量可以在该方法中被初始化。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateInputView</span><span class="params">()</span> </span>&#123;</div><div class="line">        keyboardView = (KeyboardView) getLayoutInflater().inflate(R.layout.keyboard, <span class="keyword">null</span>);</div><div class="line">        keyboard = <span class="keyword">new</span> Keyboard(<span class="keyword">this</span>, R.xml.qwerty);</div><div class="line">        keyboardView.setKeyboard(keyboard);</div><div class="line">        keyboardView.setOnKeyboardActionListener(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">return</span> keyboardView;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@param</span> keyCode 按键的键码</div><div class="line">     *                对指定的按键播放不同的按键声音</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playClick</span><span class="params">(<span class="keyword">int</span> keyCode)</span> </span>&#123;</div><div class="line">        AudioManager am = (AudioManager) getSystemService(AUDIO_SERVICE);</div><div class="line">        <span class="keyword">switch</span> (keyCode) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">32</span>:</div><div class="line">                am.playSoundEffect(AudioManager.FX_KEYPRESS_SPACEBAR);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Keyboard.KEYCODE_DONE:</div><div class="line">            <span class="keyword">case</span> <span class="number">10</span>:</div><div class="line">                am.playSoundEffect(AudioManager.FX_KEYPRESS_RETURN);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Keyboard.KEYCODE_DELETE:</div><div class="line">                am.playSoundEffect(AudioManager.FX_KEYPRESS_DELETE);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                am.playSoundEffect(AudioManager.FX_KEYPRESS_STANDARD);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onText</span><span class="params">(CharSequence text)</span> </span>&#123;&#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swipeLeft</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swipeRight</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swipeDown</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swipeUp</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPress</span><span class="params">(<span class="keyword">int</span> primaryCode)</span> </span>&#123;&#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRelease</span><span class="params">(<span class="keyword">int</span> primaryCode)</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>需要特别说明的是：一旦用户在键盘上按下了一个按键，onKey方法将会带着被按下的按键的所代表的键值参数而被调用，基于键值的不同，将会执行以下动作：</strong></p>
<table>
<thead>
<tr>
<th>键值</th>
<th>指定的动作</th>
</tr>
</thead>
<tbody>
<tr>
<td>KEYCODE_DELETE</td>
<td>将会使用deleteSurroundingText 方法删除光标左侧的一个字符。</td>
</tr>
<tr>
<td>KEYCODE_DONE</td>
<td>将会激发一个KEYCODE_ENTER 事件。</td>
</tr>
<tr>
<td>KEYCODE_SHIFT</td>
<td>caps变量的值将会被改变并且通过setShifted方法更新键盘的状态。整个键盘都会被重新绘制来保证状态改变之后按键的label标签可以被更新。其中：invalidateAllKeys 方法将可以重绘所有按键。</td>
</tr>
<tr>
<td>普通键值</td>
<td>将会被简单的转换为一个字符然后发送到文本输入域中，如果caps变量被设置为true，那么按键字符都将被转换为大写。</td>
</tr>
</tbody>
</table>
<p>##编译运行</p>
<p>编译运行，在手机上运行的效果如下图：</p>
<p><img src="http://i1.piimg.com/e15673195304af50.jpg" alt="" title="键盘运行效果"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##前言&lt;/p&gt;
&lt;p&gt;&amp;emsp;&amp;emsp;由于最近做的一个Android项目需要用到用户的输入一些字符，常规的输入法输入非常的不方便。因此有必要自定义一个输入法来完成这个过程。此处给出一个简单的输入法Demo&lt;br&gt;来帮助理解自定义输入法的一些实现过程。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;有关输入法的一些说明，请参见:&lt;a href=&quot;http://notes.xiamo.tk/2015-04-01-Create-an-Android-IME.html&quot;&gt;Create a Android IME&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Android" scheme="https://notes.wanghao.work/categories/Android/"/>
    
    
      <category term="Android" scheme="https://notes.wanghao.work/tags/Android/"/>
    
      <category term="IME" scheme="https://notes.wanghao.work/tags/IME/"/>
    
  </entry>
  
  <entry>
    <title>部署PPTP and OpenConnect VPN</title>
    <link href="https://notes.wanghao.work/2015-08-28-%E5%90%8C%E6%97%B6%E9%83%A8%E7%BD%B2PPTP-Server-and-OpenConnect-Server.html"/>
    <id>https://notes.wanghao.work/2015-08-28-同时部署PPTP-Server-and-OpenConnect-Server.html</id>
    <published>2015-08-28T15:17:55.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>由于几天之前<a href="https://github.com/clowwindy" target="_blank" rel="external">@clowwindy</a>被某部门请喝茶，导致现Github上Shadowsocks项目源码被迫全部清除。非常感谢clowwindy所做的一切，希望他一切安好。</p>
<p>虽然目前Shadowsocks还能正常使用，但是由于项目不在更新维护，还是要准备Shadowsocks的替代工具，以备不时之需，毕竟经常要上Google以及stackoverflow以及时不时看看YouTube。</p>
<p>##PPTP Server</p>
<p>如果对速度要求较高，又不那么在乎连接的安全性的话，PPTP VPN 是一个不错的选择，有着兼容性较好,速度快配置简单的优点。当然也有着加密强度不够，连接强度、抗干扰能力弱等缺点，但是基本上够用咯~</p>
<a id="more"></a>
<p>###配置方法</p>
<p>如何配置PPTP VPN服务器，博主写了一个简单的脚本来自动一键配置PPTP，脚本地址：<a href="https://github.com/smilexiamo/AutoProxyScript" target="_blank" rel="external">https://github.com/smilexiamo/AutoProxyScript</a></p>
<p>具体用法此处就不再赘述，运行脚本等着配置完成即可使用。</p>
<p><strong>需要注意的是该脚本运行环境为Debian或者Ubuntu。不适用于CentOS之类的Red Hat系Linux。</strong></p>
<p>###添加PPTP用户</p>
<p>编辑<code>/etc/ppp/chap-secrets</code>文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/ppp/chap-secrets</div></pre></td></tr></table></figure></p>
<p>按照如下格式添加用户，每行一个即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Secrets for authentication using CHAP</span></div><div class="line"><span class="comment"># client    server       secret       IP addresses</span></div><div class="line">  vpn_user01  pptpd    vpn_password01     *</div><div class="line">  vpn_user02  pptpd    vpn_password02     *</div></pre></td></tr></table></figure></p>
<p>##OpenConnect Server</p>
<p>对于某一些安全性要求比较高的场合，PPTP可能就不那么适合了，这个时候就可以使用OpenConnect VPN了。它通过实现Cisco的AnyConnect协议，用DTLS作为主要的加密传输协议。其主要的有点有：</p>
<ul>
<li>AnyConnect的VPN协议默认使用UDP DTLS作为数据传输，但如果有什么网络问题导致UDP传输出现问题，它会利用最初建立的TCP TLS通道作为备份通道，降低VPN断开的概率。</li>
<li>AnyConnect作为Cisco新一代的VPN解决方案，被用于许多大型企业，这些企业依赖它提供正常的商业运作。</li>
<li>OpenConnet的架设足够麻烦，如果你不是大型企业，你会用AnyConnect的概率无限趋近于零。</li>
<li>支持自定义路由表，因此是Shadowsocks比较好的替代方案。</li>
</ul>
<p>当然啦，有这么多有点，那么缺点也比较明显了：配置麻烦复杂。</p>
<p>###配置方法</p>
<p>有关如何配置的问题，这里有一个博主测试可用的还算比较干净的脚本，大大简化了配置的流程：<a href="https://github.com/fanyueciyuan/eazy-for-ss/tree/master/ocservauto" target="_blank" rel="external">https://github.com/fanyueciyuan/eazy-for-ss/tree/master/ocservauto</a></p>
<p>先运行博主的脚本，配置好PPTP，在运行此脚本配置好OpenConnect Server。博主测试这两种服务器是可以同时运行的。</p>
<p>###连接方法<br>虽然OpenConnect Server兼容Cisco的Anyconnect，但是博主在<a href="https://software.cisco.com/download/navigator.html?mdfid=278875403&amp;flowid=17001" target="_blank" rel="external">windows</a>以及<a href="https://play.google.com/store/apps/details?id=com.cisco.anyconnect.vpn.android.avf" target="_blank" rel="external">Android平台</a>使用Cisco官方的客户端均出现可以连接但是无法访问网络的问题。改用OpenConnect Server官方推荐的客户端就正常了。以下给出OpenConnect Server官方客户端链接：</p>
<ul>
<li><a href="https://github.com/openconnect/openconnect-gui/releases" target="_blank" rel="external">Windows OpenConnect-GUI</a></li>
<li><a href="https://github.com/openconnect/openconnect-gui/wiki/MacOSX" target="_blank" rel="external">MacOSX OpenConnect-GUI</a></li>
<li><a href="https://play.google.com/store/apps/details?id=app.openconnect" target="_blank" rel="external">Android OpenConnect-GUI</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于几天之前&lt;a href=&quot;https://github.com/clowwindy&quot;&gt;@clowwindy&lt;/a&gt;被某部门请喝茶，导致现Github上Shadowsocks项目源码被迫全部清除。非常感谢clowwindy所做的一切，希望他一切安好。&lt;/p&gt;
&lt;p&gt;虽然目前Shadowsocks还能正常使用，但是由于项目不在更新维护，还是要准备Shadowsocks的替代工具，以备不时之需，毕竟经常要上Google以及stackoverflow以及时不时看看YouTube。&lt;/p&gt;
&lt;p&gt;##PPTP Server&lt;/p&gt;
&lt;p&gt;如果对速度要求较高，又不那么在乎连接的安全性的话，PPTP VPN 是一个不错的选择，有着兼容性较好,速度快配置简单的优点。当然也有着加密强度不够，连接强度、抗干扰能力弱等缺点，但是基本上够用咯~&lt;/p&gt;
    
    </summary>
    
      <category term="折腾" scheme="https://notes.wanghao.work/categories/%E6%8A%98%E8%85%BE/"/>
    
    
      <category term="Proxy" scheme="https://notes.wanghao.work/tags/Proxy/"/>
    
  </entry>
  
  <entry>
    <title>MySQL开启远程访问授权</title>
    <link href="https://notes.wanghao.work/2015-08-20-MySQL%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90.html"/>
    <id>https://notes.wanghao.work/2015-08-20-MySQL开启远程访问权限.html</id>
    <published>2015-08-20T09:39:55.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>在做开发测试的时候，经常会用到MySQL数据库。测试使用的数据库不在本机上而在虚拟机里，访问数据库就比较蛋碎了。因为MySQL数据库默认是没有开放远程访问授权的。不能够直接访问，下面介绍两种常用的开启MySQL远程访问权限开启方法:</p>
<h3 id="方法一：修改user表开启远程访问"><a href="#方法一：修改user表开启远程访问" class="headerlink" title="方法一：修改user表开启远程访问"></a>方法一：修改<code>user</code>表开启远程访问</h3><p>在终端中键入以下命令登录MySQL数据库:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -uROOT -pPASSWORD</div></pre></td></tr></table></figure>
<p>其中，<font color="red"><code>ROOT</code></font>表示登录的用户名，<font color="red"><code>PASSWORD</code></font>表示登录的该用户的密码。登录成功之后，访问<code>mysql</code>数据库，依次执行以下SQL语句:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  use mysql;</div><div class="line">mysql&gt;  select host,user from user;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>将会打印出MySQL数据库中所有用户以及其授权访问地址，以博主的为测试数据库为例，打印信息如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">+-------------------------+------------------+</div><div class="line">| host                    | user             |</div><div class="line">+-------------------------+------------------+</div><div class="line">| 127.0.0.1               | root             |</div><div class="line">| ::1                     | root             |</div><div class="line">| localhost               | debian-sys-maint |</div><div class="line">| localhost               | root             |</div><div class="line">| xiamo-virtual-machine   | root             |</div><div class="line">+-------------------------+------------------+</div><div class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<p>可以看到，<font color="red"><code>host</code></font>栏表示登录主机，可以是ip地址或者主机名，不难发现其实他们都是虚拟机本地地址，因此我们是没办法从物理机访问该数据库的。因此，我们只需要更改登录主机的<font color="red"><code>host</code></font>栏目里的地址，便可以在远程主机上访问了。</p>
<p>比如博主通过<code>桥接模式</code>与虚拟机相连接，物理机的ip地址为<code>192.168.1.101</code>,虚拟机的ip地址为<code>192.168.1.103</code>，我们可以执行以下SQL语句来达到远程访问MySQL:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  use mysql;</div><div class="line">mysql&gt;  update user <span class="built_in">set</span> host=<span class="string">'192.168.1.101'</span> <span class="built_in">where</span> user=<span class="string">'root'</span> and host=<span class="string">'127.0.0.1'</span>;</div></pre></td></tr></table></figure>
<p>然后再执行以下命令重启MySQL即可通过物理机访问MySQL啦:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mysql restart</div></pre></td></tr></table></figure></p>
<p>也可以执行以下SQL语句刷新授权信息来达到不重启MySQL即可远程访问:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  FLUSH PRIVILEGES;</div></pre></td></tr></table></figure></p>
<p>当然，在大多数时候，我们都希望可以从任意ip地址访问，而不是仅限于指定的ip，这样就算ip地址变动也不会再次折腾，这个时候我们可以执行以下SQL:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  use mysql;</div><div class="line">mysql&gt;  update user <span class="built_in">set</span> host=<span class="string">'%'</span> <span class="built_in">where</span> user=<span class="string">'root'</span> and host=<span class="string">'127.0.0.1'</span>;</div></pre></td></tr></table></figure>
<p>这样，将<font color="red"><code>host</code></font>值改为<font color="red"><code>%</code></font>,就可以在任意主机登录到MySQL咯。</p>
<h3 id="方法二：通过授权语句开启远程访问"><a href="#方法二：通过授权语句开启远程访问" class="headerlink" title="方法二：通过授权语句开启远程访问"></a>方法二：通过授权语句开启远程访问</h3><p>与修改user表的方法相同，在终端中连接到MySQL数据库。然后执行以下SQL语句即可授权指定用户远程访问MySQL:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  grant all privileges  on *.* to USERNAME@<span class="string">'%'</span> identified by <span class="string">"PASSWORD"</span>;</div><div class="line">mysql&gt;  FLUSH PRIVILEGES;</div></pre></td></tr></table></figure></p>
<p>需要注意的是，其中<code>*.*</code>的含义为：</p>
<ul>
<li>第一个<font color="red"><code>*</code></font>为MySQL中的数据库名。</li>
<li>第二个<font color="red"><code>*</code></font>为MySQL中的指定的数据库的表名。</li>
<li><font color="red"><code>USERNAME</code></font>为授权用户的用户名。</li>
<li><font color="red"><code>%</code></font>为任意主机，也可以写指定的ip地址或者主机名。</li>
<li><font color="red"><code>PASSWORD</code></font>为授权改用户在指定的数据访问MySQL时的密码，<strong>如果该密码和本地用户同名用户的密码不一致，远程访问时务必使用该授权密码</strong>。</li>
</ul>
<h3 id="解决Linux下，MySQL中文乱码问题"><a href="#解决Linux下，MySQL中文乱码问题" class="headerlink" title="解决Linux下，MySQL中文乱码问题"></a>解决Linux下，MySQL中文乱码问题</h3><p>首先，当然是确保表或者创建的数据库的编码方式为<code>UTF-8</code>啦，在这些都没问题的情况下，执行以下SQL语句，查看MySQL的编码情况：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  show variables like <span class="string">'character%'</span>;</div></pre></td></tr></table></figure></p>
<p>一般情况下，将会得到以下结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">+--------------------------+----------------------------+</div><div class="line">| Variable_name            | Value                      |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| character_set_client     | utf8                       |</div><div class="line">| character_set_connection | utf8                       |</div><div class="line">| character_set_database   | latin1                     |</div><div class="line">| character_set_filesystem | binary                     |</div><div class="line">| character_set_results    | utf8                       |</div><div class="line">| character_set_server     | latin1                     |</div><div class="line">| character_set_system     | utf8                       |</div><div class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>此时，我们修改位于<font color="red"><code>/etc/mysql/my.cnf</code></font>的<font color="red"><code>my.cnf</code></font>文件:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/mysql/my.cnf</div></pre></td></tr></table></figure></p>
<p>在<font color="red"><code>[client]</code></font>中加入:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">default-character-set=utf8</div></pre></td></tr></table></figure></p>
<p>在<font color="red"><code>[mysqld]</code></font>中加入:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">character-set-server=utf8</div></pre></td></tr></table></figure></p>
<p>退出保存之后重启MySQL，再次执行，得到如下结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mysql&gt;  show variables like <span class="string">'character%'</span>;</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| Variable_name            | Value                      |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| character_set_client     | utf8                       |</div><div class="line">| character_set_connection | utf8                       |</div><div class="line">| character_set_database   | utf8                       |</div><div class="line">| character_set_filesystem | binary                     |</div><div class="line">| character_set_results    | utf8                       |</div><div class="line">| character_set_server     | utf8                       |</div><div class="line">| character_set_system     | utf8                       |</div><div class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>即可看到编码都为UTF-8啦~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在做开发测试的时候，经常会用到MySQL数据库。测试使用的数据库不在本机上而在虚拟机里，访问数据库就比较蛋碎了。因为MySQL数据库默认是没有开放远程访问授权的。不能够直接访问，下面介绍两种常用的开启MySQL远程访问权限开启方法:&lt;/p&gt;
&lt;h3 id=&quot;方法一：修改user表开启远程访问&quot;&gt;&lt;a href=&quot;#方法一：修改user表开启远程访问&quot; class=&quot;headerlink&quot; title=&quot;方法一：修改user表开启远程访问&quot;&gt;&lt;/a&gt;方法一：修改&lt;code&gt;user&lt;/code&gt;表开启远程访问&lt;/h3&gt;&lt;p&gt;在终端中键入以下命令登录MySQL数据库:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mysql -uROOT -pPASSWORD&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，&lt;font color=red&gt;&lt;code&gt;ROOT&lt;/code&gt;&lt;/font&gt;表示登录的用户名，&lt;font color=red&gt;&lt;code&gt;PASSWORD&lt;/code&gt;&lt;/font&gt;表示登录的该用户的密码。登录成功之后，访问&lt;code&gt;mysql&lt;/code&gt;数据库，依次执行以下SQL语句:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mysql&amp;gt;  use mysql;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mysql&amp;gt;  select host,user from user;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="数据库" scheme="https://notes.wanghao.work/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="MySQL" scheme="https://notes.wanghao.work/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>开启NexT主题多说主动评论邮件通知</title>
    <link href="https://notes.wanghao.work/2015-07-25-%E5%A4%9A%E8%AF%B4%E4%B8%BB%E5%8A%A8%E9%82%AE%E4%BB%B6%E6%8F%90%E9%86%92.html"/>
    <id>https://notes.wanghao.work/2015-07-25-多说主动邮件提醒.html</id>
    <published>2015-07-25T04:00:22.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>经过一段时间的折腾多说，博主发现原来多说是不支持主动评论提醒的。也就是说如果在一篇博客中有人主动评论留言的话，多说是不会邮件通知的。除非他回复了你，那么多说才会邮件通知。（怪不得博主觉得一会儿有邮件提醒一会儿没有咋个这么奇怪。。）</p>
<hr>
<p>去多说的官方一番折腾，找到了官方文档，有说到使用<code>data-author-key</code>可以设置主动邮件提醒,以下给出多说官网说明的传送门：</p>
<ul>
<li><strong><a href="http://dev.duoshuo.com/docs/51435552047fe92f490225de" target="_blank" rel="external">同步用户到多说</a></strong></li>
<li><strong><a href="http://dev.duoshuo.com/docs/5003ecd94cab3e7250000008/" target="_blank" rel="external">评论框调用代码参数说明</a></strong></li>
</ul>
<a id="more"></a>
<p>通过上面的链接查看多说的API说明，不难看要想实现评论主动邮件通知，只需要:</p>
<ul>
<li>自定义同步一个用户到多说的服务器。</li>
<li>将这个同步的用户在站点中的身份设置为作者。</li>
<li>取得自定义用户在站点中的ID。</li>
<li>将这个ID作为<code>data-author-key</code>的值加在站点的多说评论框中即可。</li>
</ul>
<p>实现上述操作之后，当其他用户评论带有<code>data-author-key</code>标示的文章时，多说服务器会默认为在向我们自定义的作者用户评论，便会向我们自定义用户的邮箱发送邮件提醒啦~</p>
<hr>
<p>分析了原理之后，我们具体应该怎么做呢？</p>
<p>很简单，只需要向多说提供的同步用户接口发个POST就行了。语言不限，不过既然我们用的是Hexo，那就以NodeJS为例吧：</p>
<ul>
<li><strong>随便在哪个地方新建一个文件夹</strong>（就是这么随意~）</li>
<li><strong>进入该文件夹，执行以下命令:</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev request</div></pre></td></tr></table></figure>
<ul>
<li><strong>新建一个<code>adduser.js</code>文件，将下面的代码粘贴进去，并修改<code>data</code>中的数据: </strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'request'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> data = &#123;</div><div class="line">  <span class="string">'short_name'</span>         : <span class="string">''</span>,     <span class="comment">// 你的short_name，后台管理那里可以看到</span></div><div class="line">  <span class="string">'secret'</span>             : <span class="string">''</span>,     <span class="comment">// 密钥，后台管理那里可以看到</span></div><div class="line">  <span class="string">'users[0][user_key]'</span> : <span class="string">'1'</span>,    <span class="comment">// 用户在站点的ID，就是后面需要设置的 data-author-key值，可以随意设置，这里默认为1吧</span></div><div class="line">  <span class="string">'users[0][name]'</span>     : <span class="string">''</span>,     <span class="comment">// 显示的名字</span></div><div class="line">  <span class="string">'users[0][email]'</span>    : <span class="string">''</span>,     <span class="comment">// 提醒的邮箱</span></div><div class="line">  <span class="string">'users[0][role]'</span>     : <span class="string">'author'</span><span class="comment">// 用户的类型，设置为作者</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">http.post(&#123;<span class="attr">url</span>:<span class="string">'http://api.duoshuo.com/users/import.json'</span>, <span class="attr">form</span>: data&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error, response, body</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!error &amp;&amp; response.statusCode == <span class="number">200</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Post data to Duoshuo success'</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Post data to Duoshuo fail'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>将上面的代码中data中的数据按照自己的多说账户设置好之后，执行以下命令完成数据同步到多说服务器:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node adduser.js</div></pre></td></tr></table></figure></p>
<ul>
<li>如果输出为<code>Post data to Duoshuo fail</code>,那么检察一下data数据是否修改正确，或者直接给我留言排查问题。</li>
<li>如果输出为<code>Post data to Duoshuo success</code>,那么就可以登录到多说的后台，在用户那里看到新添加的用户了，类似这样:<br><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/1137805359113768cao.jpg" alt="" title="多说用户界面"></li>
</ul>
<p>如果角色不是作者的话，手动更改为作者。然后我们找到<code>NexT</code>主题的<code>layout/_layout.swig</code>文件，打开并找到这段代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;% <span class="keyword">if</span> page.comments %&#125;</div><div class="line">             &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"comments"</span> id=<span class="string">"comments"</span>&gt;</div><div class="line">               &#123;% <span class="keyword">if</span> (config.duoshuo and config.duoshuo.shortname) or config.duoshuo_shortname %&#125;</div><div class="line">                 &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ds-thread"</span> data-thread-key=<span class="string">"&#123;&#123; page.path &#125;&#125;"</span></div><div class="line">                      data-title=<span class="string">"&#123;&#123; page.title &#125;&#125;"</span> data-url=<span class="string">"&#123;&#123; page.permalink &#125;&#125;"</span>&gt;</div><div class="line">                 <span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>将其修改为:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;% <span class="keyword">if</span> page.comments %&#125;</div><div class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"comments"</span> id=<span class="string">"comments"</span>&gt;</div><div class="line">    &#123;% <span class="keyword">if</span> (config.duoshuo and config.duoshuo.shortname) or config.duoshuo_shortname %&#125;</div><div class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ds-thread"</span> data-thread-key=<span class="string">"&#123;&#123; page.path &#125;&#125;"</span></div><div class="line">           data-title=<span class="string">"&#123;&#123; page.title &#125;&#125;"</span> data-url=<span class="string">"&#123;&#123; page.permalink &#125;&#125;"</span> data-author-key=<span class="string">"&#123;&#123; theme.duoshuo_info.data_author_key &#125;&#125;"</span>&gt;</div><div class="line">      <span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>然后在主题的配置文件<code>_config.yml</code>文件中增加以下一行配置:<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">duoshuo_info:</span></div><div class="line"><span class="attr">  data_author_key:</span> <span class="number">1</span> <span class="comment">#此处填写上面js脚本中的data变量中的users[0][user_key]的值，因为上面为1，这里我就填写为1了。</span></div></pre></td></tr></table></figure></p>
<p>当然你可以也可直接写死为1，像这个样子:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;% <span class="keyword">if</span> page.comments %&#125;</div><div class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"comments"</span> id=<span class="string">"comments"</span>&gt;</div><div class="line">    &#123;% <span class="keyword">if</span> (config.duoshuo and config.duoshuo.shortname) or config.duoshuo_shortname %&#125;</div><div class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ds-thread"</span> data-thread-key=<span class="string">"&#123;&#123; page.path &#125;&#125;"</span></div><div class="line">           data-title=<span class="string">"&#123;&#123; page.title &#125;&#125;"</span> data-url=<span class="string">"&#123;&#123; page.permalink &#125;&#125;"</span> data-author-key=<span class="string">"1"</span>&gt;</div><div class="line">      <span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>然后重新博客文件并发布，这样在就可以当其他人评论你的博客的时候主动发邮件通知啦~像这个样子的:</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/1137805358f327217do.jpg" alt="" title="多说主动提醒示例"></p>
<p>像这样子，就让我们的<code>NexT</code>支持多说主动评论邮件通知啦，感谢<a href="http://www.arao.me/" target="_blank" rel="external">@arao</a>的友情出镜~</p>
<p><strong>PS:这种邮件提醒不是实时提醒，而是每天一封汇总邮件。如果你中途查看了这个评论的话，也是不会邮件提醒的~</strong></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;经过一段时间的折腾多说，博主发现原来多说是不支持主动评论提醒的。也就是说如果在一篇博客中有人主动评论留言的话，多说是不会邮件通知的。除非他回复了你，那么多说才会邮件通知。（怪不得博主觉得一会儿有邮件提醒一会儿没有咋个这么奇怪。。）&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;去多说的官方一番折腾，找到了官方文档，有说到使用&lt;code&gt;data-author-key&lt;/code&gt;可以设置主动邮件提醒,以下给出多说官网说明的传送门：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://dev.duoshuo.com/docs/51435552047fe92f490225de&quot;&gt;同步用户到多说&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://dev.duoshuo.com/docs/5003ecd94cab3e7250000008/&quot;&gt;评论框调用代码参数说明&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Hexo" scheme="https://notes.wanghao.work/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://notes.wanghao.work/tags/Hexo/"/>
    
      <category term="多说" scheme="https://notes.wanghao.work/tags/%E5%A4%9A%E8%AF%B4/"/>
    
  </entry>
  
  <entry>
    <title>基于Debian Linux搭建Git服务器</title>
    <link href="https://notes.wanghao.work/2015-07-18-%E5%9F%BA%E4%BA%8EDebian-Linux%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8.html"/>
    <id>https://notes.wanghao.work/2015-07-18-基于Debian-Linux搭建Git服务器.html</id>
    <published>2015-07-18T09:47:37.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;因为一些众所周知的原因，某些项目不适合开源（代码写的烂我会乱说？(╯﹏╰)b ）。又因为博主不是壕，买不起Github的私有空间，所以只能利用手头上的Debian服务器搭建Git服务器咯~</p>
<hr>
<p>###安装Git</p>
<p>&ensp;&ensp;&ensp;&ensp;要搭建Git服务器，第一步当然是要安装Git了，键入以下命令来完成Git的安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure>
<p>###新建Git用户</p>
<p>&ensp;&ensp;&ensp;&ensp;出于安全的原因考虑，我们肯定是不会使用<code>root</code>或者其它具有完整的shell执行权限的用户来运行Git的。因此，我们需要创建一个<code>git</code>用户来运行<code>git</code>服务。</p>
<p>键入以下命令来完成<code>git</code>用户的创建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo adduser git</div></pre></td></tr></table></figure>
<p>创建用户的途中会要求输入用户密码，这个密码请务必记住，这个密码的作用我们后面再说。<code>git</code>用户的其它配置使用默认值直接回车就行。</p>
<p>###禁用shell登录</p>
<p><code>git</code>用户创建完成之后，系统默认是为其分配的<code>bash</code>的，我们不希望<code>git</code>用户拥有shell执行权限，因此我们需要更改<code>git</code>用户的默认shell，使其不允许登录shell。</p>
<p>我们可以通过编辑<font color="red"><code>/etc/passwd</code></font>文件来完成对<code>git</code>用户shell的更改。</p>
<p>键入以下命令编辑<font color="red"><code>/etc/passwd</code></font>文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/passwd</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>找到类似下面的一行（一般在文件的末尾）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git:x:1000:1000:,,,:/home/git:/usr/bin/bash</div></pre></td></tr></table></figure>
<p>修改为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git:x:1000:1000:,,,:/home/git:/usr/bin/git-shell</div></pre></td></tr></table></figure></p>
<p>如果你不确定<font color="red"><code>git-shell</code></font>是不是在<font color="red"><code>/usr/bin/git-shell</code></font>这个位置的话，可以使用以下命令来查看<code>git-shell</code>的路径：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">which</span> git-shell</div></pre></td></tr></table></figure></p>
<p>这样，<code>git</code>用户可以正常通过<code>ssh</code>使用git，但无法登录shell，因为我们为<code>git用户</code>指定的<code>git-shell</code>每次一登录就自动退出。</p>
<p>###Git密钥登录</p>
<p>既然是私有Git服务器，当然必要的<code>push</code>和<code>pull</code>以及<code>clone</code>等操作不能让其他未经允许的人使用了。当然，我们也不想每次进行远程仓库操作的时候都输入<code>git</code>用户的密码。</p>
<p>因此，通过ssh密钥证书的方式就很有必要了~</p>
<ul>
<li>如同Github导入公钥一样，首先收集授权访问用户的公钥文件，也就是他们的<font color="red"><code>id_rsa.pub</code></font>文件。</li>
<li>复制<code>id_rsa.pub</code>文件其中全部的内容。</li>
<li>将<font color="red"><code>id_rsa.pub</code></font>文件其中全部的内容导入到Git服务器的<font color="red"><code>/home/git/.ssh/authorized_keys</code></font>文件中，每一行导入一个公钥文件。</li>
</ul>
<p>如果没有<font color="red"><code>/home/git/.ssh/authorized_keys</code></font>文件，请执行以下命令自行创建：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /home/git</div><div class="line">mkdir .ssh</div><div class="line"><span class="built_in">cd</span> .ssh</div><div class="line">touch authorized_keys</div></pre></td></tr></table></figure></p>
<p><strong>这样，凡是添加了公钥到<font color="red"><code>/home/git/.ssh/authorized_keys</code></font>文件的用户都能够正常的使用远程仓库的常用操作了，如果Git公钥没有被添加到<font color="red"><code>/home/git/.ssh/authorized_keys</code></font>文件中又想执行远程仓库的操作的话，那么就需要用到上面<code>git</code>用户的密码了，因为<code>git</code>会要求输入Git服务器的<code>git</code>用户的密码。这就是上面设置<code>git</code>用户密码的作用了~</strong></p>
<p>###初始化服务器Git仓库</p>
<p>上面的准备工作做完，就需要在Git服务器上选定一个目录作为Git仓库了。假定我们选择<font color="red"><code>/gitserver/Demo.git</code></font>作为Git仓库，那么我们首先需要执行以下命令创建<font color="red"><code>/gitserver</code></font>目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /</div><div class="line">mkdir gitserver</div><div class="line"><span class="built_in">cd</span> gitserver</div></pre></td></tr></table></figure>
<p>然后进入<code>gitserver</code>目录，执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo git init --bare demo.git</div></pre></td></tr></table></figure>
<p>Git就会创建一个裸仓库，裸仓库没有工作区，因为Git服务器上的Git仓库主要是为了共享，所以不让用户直接登录到Git服务器上去修改工作区。</p>
<p><strong>Git服务器上的Git仓库通常都以<font color="red"><code>.git</code></font>结尾。</strong></p>
<p>###修改Git仓库owner</p>
<p>创建好仓库之后，我们需要将仓库的owner设置为<code>git</code>用户，不让我们前面为<code>git</code>用户所做的配置就没啥意义了~</p>
<p>执行以下命令，修改仓库的owner：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chown -R git:git demo.git</div></pre></td></tr></table></figure></p>
<p>###克隆远程仓库</p>
<p>现在就可以通过<code>git clone</code>命令克隆Git服务器上的<code>demo</code>仓库了，在各自的PC上执行以下命令以完成克隆：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> ssh://git@server:/gitserver/demo.git</div><div class="line">Cloning into <span class="string">'demo'</span>...</div><div class="line">warning: You appear to have cloned an empty repository.</div></pre></td></tr></table></figure>
<p>其中需要注意的是：</p>
<ul>
<li>上述命令<code>git clone ssh://git@SERVER:/gitserver/demo.git</code>中,<font color="red"><code>SERVER</code></font>的值为你的服务器的<font color="red"><code>ip地址</code></font>或者<font color="red"><code>域名</code></font>。</li>
<li>如果你的服务器更改了默认的ssh端口号，那么需要在地址中指出，像这样：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> ssh://git@server:PORT/gitserver/demo.git</div></pre></td></tr></table></figure>
<p>其中<font color="red"><code>PORT</code></font>即为更改之后的ssh端口号。</p>
<p>例如，博主对服务器做了A记录的域名解析，也更改了默认端口号为9669，那么执行的克隆地址的命令即为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> ssh://git@server.xiamo.tk:9669/gitserver/demo.git</div></pre></td></tr></table></figure></p>
<p>后面的操作不用我多说，大家也都懂的了~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;因为一些众所周知的原因，某些项目不适合开源（代码写的烂我会乱说？(╯﹏╰)b ）。又因为博主不是壕，买不起Github的私有空间，所以只能利用手头上的Debian服务器搭建Git服务器咯~&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;###安装Git&lt;/p&gt;
&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;要搭建Git服务器，第一步当然是要安装Git了，键入以下命令来完成Git的安装：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;sudo apt-get install git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;###新建Git用户&lt;/p&gt;
&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;出于安全的原因考虑，我们肯定是不会使用&lt;code&gt;root&lt;/code&gt;或者其它具有完整的shell执行权限的用户来运行Git的。因此，我们需要创建一个&lt;code&gt;git&lt;/code&gt;用户来运行&lt;code&gt;git&lt;/code&gt;服务。&lt;/p&gt;
&lt;p&gt;键入以下命令来完成&lt;code&gt;git&lt;/code&gt;用户的创建：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;sudo adduser git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;创建用户的途中会要求输入用户密码，这个密码请务必记住，这个密码的作用我们后面再说。&lt;code&gt;git&lt;/code&gt;用户的其它配置使用默认值直接回车就行。&lt;/p&gt;
&lt;p&gt;###禁用shell登录&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git&lt;/code&gt;用户创建完成之后，系统默认是为其分配的&lt;code&gt;bash&lt;/code&gt;的，我们不希望&lt;code&gt;git&lt;/code&gt;用户拥有shell执行权限，因此我们需要更改&lt;code&gt;git&lt;/code&gt;用户的默认shell，使其不允许登录shell。&lt;/p&gt;
&lt;p&gt;我们可以通过编辑&lt;font color=red&gt;&lt;code&gt;/etc/passwd&lt;/code&gt;&lt;/font&gt;文件来完成对&lt;code&gt;git&lt;/code&gt;用户shell的更改。&lt;/p&gt;
&lt;p&gt;键入以下命令编辑&lt;font color=red&gt;&lt;code&gt;/etc/passwd&lt;/code&gt;&lt;/font&gt;文件：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vim /etc/passwd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://notes.wanghao.work/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://notes.wanghao.work/tags/Linux/"/>
    
      <category term="Git" scheme="https://notes.wanghao.work/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>自动备份Hexo博客源文件</title>
    <link href="https://notes.wanghao.work/2015-07-06-%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BDHexo%E5%8D%9A%E5%AE%A2%E6%BA%90%E6%96%87%E4%BB%B6.html"/>
    <id>https://notes.wanghao.work/2015-07-06-自动备份Hexo博客源文件.html</id>
    <published>2015-07-06T04:49:01.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;用Hexo写博客是一件比较享受的事情，无奈如果换电脑的话，备份博客就是一件比较闹心的事情。</p>
<p>###前言</p>
<p>&ensp;&ensp;我曾经给出过通过Git备份Hexo博客源文件的方式，这种方式虽然能够备份Hexo博客的源文件，但是对于博主这种懒人，每次更新博文都需要输入两三行重复的Git命令真是一件麻烦的事情。况且指不定哪天就搞忘push到github上了。</p>
<a id="more"></a>
<p>###原理</p>
<p>前两天博主刚刚编写过关于<strong><a href="https://notes.wanghao.work/2015-06-29-Hexo%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%BC%96%E8%BE%91%E5%99%A8.html">Hexo添加文章时自动打开编辑器</a></strong>的相关文章，其原理就是利用<code>NodeJS</code>的事件监听机制实现监听Hexo的<code>new</code>事件来启动编辑器，完成自动启动编辑器的操作。</p>
<p>那么可不可以通过通过监听Hexo的其它事件来完成自动执行Git命令完成自动备份呢？通过查阅<a href="https://hexo.io/zh-cn/api/events.html" target="_blank" rel="external">Hexo文档</a>，找到了Hexo的主要事件，见下表：</p>
<table>
<thead>
<tr>
<th>事件名</th>
<th>事件发生时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>deployBefore</td>
<td>在部署完成前发布</td>
</tr>
<tr>
<td>deployAfter</td>
<td>在部署成功后发布</td>
</tr>
<tr>
<td>exit</td>
<td>在 Hexo 结束前发布</td>
</tr>
<tr>
<td>generateBefore</td>
<td>在静态文件生成前发布</td>
</tr>
<tr>
<td>generateAfter</td>
<td>在静态文件生成后发布</td>
</tr>
<tr>
<td>new</td>
<td>在文章文件建立后发布</td>
</tr>
</tbody>
</table>
<p>于是我们就可以通过监听Hexo的<code>deployAfter</code>事件，待上传完成之后自动运行Git备份命令，从而达到自动备份的目的。</p>
<p>###实现</p>
<p>####将Hexo目录加入Git仓库</p>
<p>本脚本需要<font color="red"><code>提前</code></font>将Hexo加入Git仓库并与Github或者Gitcafe远程仓库绑定之后，才能正常工作。如果你不知道怎么操作，请参考这篇博文：</p>
<ul>
<li><strong><a href="https://notes.wanghao.work/2015-04-06-%E5%A4%87%E4%BB%BDHexo%E5%8D%9A%E5%AE%A2%E6%BA%90%E6%96%87%E4%BB%B6.html">备份Hexo博客源文件</a></strong></li>
</ul>
<p>####安装<code>shelljs</code>模块</p>
<p>要实现这个自动备份功能，需要依赖NodeJs的一个<code>shelljs</code>模块,该模块重新包装了<code>child_process</code>,调用系统命令更加的方便。（其实就是因为博主懒( ╯▽╰)）该模块需要安装后使用。</p>
<p>在命令中键入以下命令，完成<code>shelljs</code>模块的安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save shelljs</div></pre></td></tr></table></figure>
<p>####编写自动备份脚本</p>
<p>待到模块安装完成，在<code>Hexo</code>根目录的<code>scripts</code>文件夹下新建一个js文件，文件名随意取。</p>
<p><strong>如果没有<code>scripts</code>目录，请新建一个。</strong></p>
<p>然后在脚本中，写入以下内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'shelljs/global'</span>);</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	hexo.on(<span class="string">'deployAfter'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">//当deploy完成后执行备份</span></div><div class="line">		run();</div><div class="line">	&#125;);</div><div class="line">&#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"产生了一个错误&lt;(￣3￣)&gt; !，错误详情为："</span> + e.toString());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!which(<span class="string">'git'</span>)) &#123;</div><div class="line">		echo(<span class="string">'Sorry, this script requires git'</span>);</div><div class="line">		exit(<span class="number">1</span>);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		echo(<span class="string">"======================Auto Backup Begin==========================="</span>);</div><div class="line">		cd(<span class="string">'D:/hexo'</span>);    <span class="comment">//此处修改为Hexo根目录路径</span></div><div class="line">		<span class="keyword">if</span> (exec(<span class="string">'git add --all'</span>).code !== <span class="number">0</span>) &#123;</div><div class="line">			echo(<span class="string">'Error: Git add failed'</span>);</div><div class="line">			exit(<span class="number">1</span>);</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (exec(<span class="string">'git commit -am "Form auto backup script\'s commit"'</span>).code !== <span class="number">0</span>) &#123;</div><div class="line">			echo(<span class="string">'Error: Git commit failed'</span>);</div><div class="line">			exit(<span class="number">1</span>);</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (exec(<span class="string">'git push origin master'</span>).code !== <span class="number">0</span>) &#123;</div><div class="line">			echo(<span class="string">'Error: Git push failed'</span>);</div><div class="line">			exit(<span class="number">1</span>);</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		echo(<span class="string">"==================Auto Backup Complete============================"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><strong>其中，需要修改第<font color="red"><code>17</code></font>行的<font color="red"><code>D:/hexo</code></font>路径为Hexo的根目录路径。（脚本中的路径为博主的Hexo路径）</strong></p>
</li>
<li><p><strong>如果你的Git远程仓库名称不为<font color="red"><code>origin</code></font>的话，还需要修改第<font color="red"><code>28</code></font>行执行的push命令，修改成自己的远程仓库名和相应的分支名。</strong></p>
</li>
</ul>
<p>保存脚本并退出，然后执行<code>hexo deploy</code>命令，将会得到类似以下结果:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">INFO  Deploying: git&gt;</div><div class="line">INFO  Clearing .deploy folder...</div><div class="line">INFO  Copying files from public folder...</div><div class="line">[master 3020788] Site updated: 2015-07-06 15:08:06</div><div class="line"> 5 files changed, 160 insertions(+), 58 deletions(-)</div><div class="line">Branch master <span class="built_in">set</span> up to track remote branch gh-pages from git@github.com:smilexi</div><div class="line">amo/notes.git.</div><div class="line">To git@github.com:smilexiamo/notes.git</div><div class="line">   02adbe4..3020788  master -&gt; gh-pages</div><div class="line">On branch master</div><div class="line">nothing to commit, working directory clean</div><div class="line">Branch master <span class="built_in">set</span> up to track remote branch gitcafe-pages from git@gitcafe.com:s</div><div class="line">milexiamo/smilexiamo.git.</div><div class="line">To git@gitcafe.com:smilexiamo/smilexiamo.git</div><div class="line">   02adbe4..3020788  master -&gt; gitcafe-pages</div><div class="line">INFO  Deploy <span class="keyword">done</span>: git</div><div class="line">======================Auto Backup Begin===========================</div><div class="line">[master f044360] Form auto backup script<span class="string">'s commit</span></div><div class="line"> 2 files changed, 35 insertions(+), 2 deletions(-)</div><div class="line"> rewrite db.json (100%)</div><div class="line">To git@github.com:smilexiamo/hexo.git</div><div class="line">   8f2b4b4..f044360  master -&gt; master</div><div class="line">==================Auto Backup Complete============================</div></pre></td></tr></table></figure>
<p>这样子，每次更新博文并<code>deploy</code>到服务器上之后，备份就自动启动并完成备份啦~是不是很方便呢？</p>
<p>Enjoy it！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;用Hexo写博客是一件比较享受的事情，无奈如果换电脑的话，备份博客就是一件比较闹心的事情。&lt;/p&gt;
&lt;p&gt;###前言&lt;/p&gt;
&lt;p&gt;&amp;ensp;&amp;ensp;我曾经给出过通过Git备份Hexo博客源文件的方式，这种方式虽然能够备份Hexo博客的源文件，但是对于博主这种懒人，每次更新博文都需要输入两三行重复的Git命令真是一件麻烦的事情。况且指不定哪天就搞忘push到github上了。&lt;/p&gt;
    
    </summary>
    
      <category term="Hexo" scheme="https://notes.wanghao.work/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://notes.wanghao.work/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>EditPlus Licenses在线生成器</title>
    <link href="https://notes.wanghao.work/2015-07-02-EditPlus-Licenses%E5%9C%A8%E7%BA%BF%E7%94%9F%E6%88%90%E5%99%A8.html"/>
    <id>https://notes.wanghao.work/2015-07-02-EditPlus-Licenses在线生成器.html</id>
    <published>2015-07-02T11:22:03.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>EditPlus是一款博主非常喜欢的文本编辑器，相比notepad++以及EverEdit有着轻便小巧迅速的优点。</p>
<p>##简介</p>
<p>以下是来自维基百科简介：</p>
<blockquote>
<p>EditPlus是Windows下的一个文本编辑器。支持语法高亮，自动完成等功能。对HTML文件编辑特别方便。可通过FTP远程编辑。EditPlus由韩国人Kim Sang-il（김상일）开发。</p>
</blockquote>
<a id="more"></a>
<p>##下载</p>
<p>下面博主为懒人给出EditPuls下载链接吧：</p>
<ul>
<li><a href="https://www.editplus.com/" target="_blank" rel="external">EditPlus官网</a></li>
<li><a href="http://www.cnblogs.com/hanzisearcher/" target="_blank" rel="external">EditPlus官方认可的汉化补丁</a></li>
</ul>
<p>下载安装之后，首次运行会需要输入激活码，在下面的输入框中输入用户名，点击<code>生成</code>生成激活码，将用户名和激活码对应输入注册即可了~</p>
<p><script src="/js/editplusgenkey.js"></script></p>
<center><br> <span>用户名:</span><br> <input type="text" id="username" size="20" placeholder="请在此处输入您的用户名"><br><br> <span>注册码:</span><br> <input type="text" size="20" readonly="true" name="regcode" id="regcode" placeholder="请粘贴此处的注册码"><p></p><br> <input type="submit" value="猛击我生成激活码" onclick="generateEditplusLicence()"><br> </center>

<p>Enjoy it！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;EditPlus是一款博主非常喜欢的文本编辑器，相比notepad++以及EverEdit有着轻便小巧迅速的优点。&lt;/p&gt;
&lt;p&gt;##简介&lt;/p&gt;
&lt;p&gt;以下是来自维基百科简介：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;EditPlus是Windows下的一个文本编辑器。支持语法高亮，自动完成等功能。对HTML文件编辑特别方便。可通过FTP远程编辑。EditPlus由韩国人Kim Sang-il（김상일）开发。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="折腾" scheme="https://notes.wanghao.work/categories/%E6%8A%98%E8%85%BE/"/>
    
    
      <category term="激活" scheme="https://notes.wanghao.work/tags/%E6%BF%80%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>常见的开源许可证</title>
    <link href="https://notes.wanghao.work/2015-06-30-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BC%80%E6%BA%90%E8%AE%B8%E5%8F%AF%E8%AF%81%E5%8C%BA%E5%88%AB.html"/>
    <id>https://notes.wanghao.work/2015-06-30-常见的开源许可证区别.html</id>
    <published>2015-06-30T07:18:41.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>如何为代码选择开源许可证，这是一个问题。</p>
<p>世界上的开源许可证，大概有上百种。很少有人搞得清楚它们的区别。千言万语，比不上一张图：</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/1135650364a1ffda02o.jpg" class="full-image"></p>
<a id="more"></a>
<p>以下是常见的六种开源协议：</p>
<ul>
<li>##<a href="http://www.gnu.org/licenses/gpl.html" target="_blank" rel="external">GPL License</a></li>
</ul>
<blockquote>
<p>GPL协议的主要内容是只要在一个软件中使用(“使用”指类库引用，修改后的代码或者衍生代码)GPL 协议的产品，则该软件产品必须也采用GPL协议，既必须也是开源和免费。这就是所谓的”传染性”。GPL协议的产品作为一个单独的产品使用没有任何问题，还可以享受免费的优势。</p>
<p><strong>由于GPL严格要求使用了GPL类库的软件产品必须使用GPL协议，对于使用GPL协议的开源代码，商业软件或者对代码有保密要求的部门就不适合集成/采用作为类库和二次开发的基础。</strong></p>
</blockquote>
<ul>
<li>##<a href="https://en.wikipedia.org/wiki/BSD_licenses" target="_blank" rel="external">BSD License</a></li>
</ul>
<blockquote>
<p>BSD开源协议是一个给于使用者很大自由的协议。基本上使用者可以”为所欲为”,可以自由的使用，修改源代码，也可以将修改后的代码作为开源或者专有软件再发布。</p>
<p>但”为所欲为”的前提当你发布使用了BSD协议的代码，或则以BSD协议代码为基础做二次开发自己的产品时，需要满足三个条件：</p>
<ul>
<li>如果再发布的产品中包含源代码，则在源代码中必须带有原来代码中的BSD协议。</li>
<li>如果再发布的只是二进制类库/软件，则需要在类库/软件的文档和版权声明中包含原来代码中的BSD协议。</li>
<li>不可以用开源代码的作者/机构名字和原来产品的名字做市场推广。</li>
</ul>
<p><strong>BSD 代码鼓励代码共享，但需要尊重代码作者的著作权。BSD由于允许使用者修改和重新发布代码，也允许使用或在BSD代码上开发商业软件发布和销售，因此是对商业集成很友好的协议。而很多的公司企业在选用开源产品的时候都首选BSD协议，因为可以完全控制这些第三方的代码，在必要的时候可以修改或者二次开发。</strong></p>
</blockquote>
<ul>
<li>##<a href="https://en.wikipedia.org/wiki/MIT_License" target="_blank" rel="external">MIT License</a></li>
</ul>
<blockquote>
<p>在所有常用的开源许可证中，MIT许可证最为简短，可能也最为广泛。它的条款非常松散，比起大部分其它许可证来说更加宽松。它的基本前提如下：</p>
<ul>
<li>该许可免费授予任何获得本软件及相关文档（合称为“软件包”）的人，许可其无限制地应用软件，包括不受限地使用、拷贝、修改、合并、出版、分发、再授权、和/或出售软件的拷贝。被许可者获取软件包提供的权利须基于以下条件：</li>
</ul>
<p><strong>以上版权声明和本许可声明必须包含在软件包的全部拷贝或实质性部分中。</strong></p>
<ul>
<li>你可以任意使用、拷贝和修改软件。没人能够限制你将软件用于任何项目、以你喜欢的格式拷贝软件任意多次、或以任何方式收费。</li>
<li>你可以免费分发软件或者出售软件，你分发软件的方式不受限制。</li>
<li>唯一的限制是软件必须附带许可协议。</li>
</ul>
<p>MIT许可证是限制最少的许可证，它基本上是说，只要附带许可证，任何人都可以利用该许可证授权的软件做任何想做的事。</p>
</blockquote>
<ul>
<li>##<a href="http://creativecommons.org/" target="_blank" rel="external">Creative Commons</a></li>
</ul>
<blockquote>
<p>知识共享（Creative Commons，简称CC）许可证并非完全的开源许可证，但设计类项目也常常使用。有各种不同的CC许可证可供使用，每种授予特定的权利。一个CC许可证包含四个基本部分，每部分即可单独生效，又可联合使用。简述如下：</p>
<ul>
<li>署名</li>
</ul>
<p><em>必须按照作者指定的方式对作品进行署名。除此之外，作品可被复制、分发、拷贝以及以其它方式使用</em></p>
<ul>
<li>相同方式共享</li>
</ul>
<ul>
<li>只能基于相同的CC许可证对作品进行修改、分发等。*</li>
</ul>
<ul>
<li>非商业性</li>
</ul>
<p><em>作品可被修改、分发等，但不得以商业为目的进行。关于什么构成商业行为，许可证条款并未提供清晰的定义，因此你可能需要在自己的项目里给予澄清。比如说，有人认为“非商业”只是简单地意味着你不能出售作品，也有人认为你不能把作品放到一个带广告的网站上，还有人认为只有当牟利发生时才能称为“商业”。</em></p>
<ul>
<li>禁止衍生</li>
</ul>
<p><em>你可以拷贝和分发授权作品，但你不得以任何方式修改、或基于原作进行创作。</em></p>
<p><strong>如前所述，CC许可证的各个部分可以联合使用。最为严格的许可证为“署名-非商业-禁止衍生”许可证，即你可以自由分享作品，但不得修改或收费，同时你必须按照作者指定的方式为作品署名。这对那些一方面希望发布作品，另一方面又希望多多少少保留对作品使用方式的控制权的作者来说，颇为不错。限制最少的CC许可证是“署名”许可证，即只要按照作者指定的方式为作品署名，就可以用作品做任何事。</strong></p>
</blockquote>
<ul>
<li>##<a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="external">Apache License</a></li>
</ul>
<blockquote>
<p>Apache许可证（2.0版）授予用户大量权利，这些权利适用于版权和专利权。由于有的许可证只适用于版权、不适用于专利权，Apache许可证的这一灵活性使其成为专利开发者的首选。</p>
<p>Apache许可证特点：</p>
<ul>
<li>权利的永久性</li>
</ul>
<p><em>一旦许可证被授予，你就可以无限期使用。</em></p>
<ul>
<li>权利的世界性</li>
</ul>
<p><em>如果许可证在某一国授予，那么它同时也授予给其它所有国家。例如，如果你在美国，而原始许可证在印度颁发，那么，你在许可证授权下使用代码并无限制。</em></p>
<ul>
<li>获取权利的免费性</li>
</ul>
<p><em>你不用预先支付任何使用费，也不用为每次使用或基于其它方式而付费。</em></p>
<ul>
<li>权利的非排他性</li>
</ul>
<p><em>你能使用经授权的软件，任何其他人也能使用。</em></p>
<ul>
<li>权利的不可撤回性</li>
</ul>
<p><em>权利一旦授予，无人能撤回。换句话说，你无需担心将来的某个时候，当你创造出授权代码的优秀衍生产品时，有人会跳出来说：“抱歉，你再也不能使用这些代码了” （许可证有条款指出，如果你就许可证授权下的任何内容起诉他人，你的许可证授权即告终结。但这仅仅适用于有专利的软件，并且只要你不起诉软件相关的任何人，你就不必担心）.</em></p>
<p><strong>Apache许可证对分发代码也有特殊要求，主要是有关给予代码作者以适当荣誉，以及保持许可证的一致性。</strong></p>
</blockquote>
<ul>
<li>##<a href="http://www.gnu.org/copyleft/lesser.html" target="_blank" rel="external">LGPL License</a></li>
</ul>
<blockquote>
<p>LGPL允许商业软件通过类库引用(link)方式使用LGPL类库而不需要开源商业软件的代码。这使得采用LGPL协议的开源代码可以被商业软件作为类库引用并发布和销售。</p>
<p>但是如果修改LGPL协议的代码或者衍生，则所有修改的代码，涉及修改部分的额外代码和衍生的代码都必须采用LGPL协议。因此LGPL协议的开源代码很适合作为第三方类库被商业软件引用，但不适合希望以LGPL协议代码为基础，通过修改和衍生的方式做二次开发的商业软件采用。</p>
<p><strong>GPL/LGPL都保障原作者的知识产权，避免有人利用开源代码复制并开发类似的产品</strong></p>
</blockquote>
<p>不难看出，即便是在这六种许可协议中作出选择，也是比较困难的。</p>
<p><a href="http://paulmillr.com/posts/simple-description-of-popular-software-licenses/" target="_blank" rel="external">乌克兰程序员Paul Bagwell</a>，画了一张分析图，说明应该怎么选择。这是我见过的最简单的讲解，只用两分钟，你就能搞清楚这六种许可证之间的最大区别。</p>
<p>以下为汉化版本，感谢<a href="http://blog.csdn.net/wadefelix/article/details/6384317" target="_blank" rel="external">wadefelix</a>的制作：</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/11356503627da387f0o.jpg" class="full-image"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;如何为代码选择开源许可证，这是一个问题。&lt;/p&gt;
&lt;p&gt;世界上的开源许可证，大概有上百种。很少有人搞得清楚它们的区别。千言万语，比不上一张图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/1135650364a1ffda02o.jpg&quot; class=&quot;full-image&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://notes.wanghao.work/categories/Notes/"/>
    
    
      <category term="笔记" scheme="https://notes.wanghao.work/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Git常用命令</title>
    <link href="https://notes.wanghao.work/2015-06-29-Git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html"/>
    <id>https://notes.wanghao.work/2015-06-29-Git常用命令.html</id>
    <published>2015-06-29T12:36:13.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://notes.wanghao.work/2015-06-29-Git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html"><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/git_logo.jpg" alt=""></a><br><a id="more"></a></p>
<p>##基本配置命令</p>
<p>###Git常用命令速查表</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/11355916837b25b3cfo.jpg" alt="" title="速查表"></p>
<p>###使用Git生成ssh密钥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa -C <span class="string">"email@example.com"</span></div></pre></td></tr></table></figure>
<p>###设置全局用户名和邮箱:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git config --global user.name <span class="string">"YourName"</span></div><div class="line">git config --global user.email <span class="string">"email@example.com"</span></div></pre></td></tr></table></figure>
<p>###初始化仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git init</div></pre></td></tr></table></figure>
<p>###添加文件到暂存区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git add &lt;filename&gt;	<span class="comment">#添加指定文件到暂存区</span></div><div class="line">git add .	<span class="comment">#添加工作区所有文件到暂存区</span></div><div class="line">git add -i	<span class="comment">#交互方式添加文件到暂存区</span></div><div class="line">git add -u	<span class="comment">#将工作区中已经变动的文件添加到暂存区，当新增加的文件不会被添加</span></div></pre></td></tr></table></figure>
<p>###提交文件到仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git commit -m <span class="string">"描述信息"</span>		<span class="comment">#提交更新</span></div><div class="line">git commit -am <span class="string">"描述信息"</span>	<span class="comment">#如果工作目录中仅是已跟踪的文件被修改或被删除，使用此提交命令</span></div></pre></td></tr></table></figure>
<p>###分支的创建、删除、和平、切换、查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">git branch	<span class="comment">#查看Git仓库中已有的分支</span></div><div class="line">git branch 新分支名 [分支起点]	<span class="comment">#创建分支，如果没有分支起点的话，则默认在当前分支的最新提交上创建分支</span></div><div class="line">git checkout 分支名	<span class="comment">#切换分支</span></div><div class="line">git checkout -b 新分支名		<span class="comment">#创建同时切换到新分支</span></div><div class="line">git merge 要被合并的分支名	<span class="comment">#合并分支</span></div><div class="line">git branch <span class="_">-d</span> 要删除的分支名	<span class="comment">#删除指定分支（如果分支没有被合并过，该命令会执行失败）</span></div><div class="line">git branch -D 要删除的分支名	<span class="comment">#删除指定分支，不管有没有被合并过</span></div><div class="line">gitk				<span class="comment">#用图形界面查看分支提交历史</span></div></pre></td></tr></table></figure>
<blockquote>
<p>合并分支过程中如果发生冲突则需要自己手动解决冲突，然后再提交。有冲突时，Git会显示哪个文件有冲突，并在冲突的文件中加上特殊的标识符号，解决完冲突后，要手动去掉这些被添加的标识符号。如果冲突比较复杂的话，最好使用其他工具来协助，通过git mergetool来启动。冲突一般是在不同的分支上对同一文件的同一位置内容进行了改动，并已提交到仓库中，这样在合并的时候就会发生冲突。</p>
</blockquote>
<p>###标签的添加、删除、查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git tag		<span class="comment">#查看标签</span></div><div class="line">git tag 标签名	<span class="comment">#创建简单的标签</span></div><div class="line">git tag <span class="_">-a</span> 标签名 -m <span class="string">'附加信息'</span>	<span class="comment">#创建附加信息的标签</span></div><div class="line">git show 标签名	<span class="comment">#通过标签查看信息</span></div><div class="line">git tag <span class="_">-d</span> 标签名	<span class="comment">#删除标签</span></div></pre></td></tr></table></figure>
<blockquote>
<p>标签可以在需要的地方，为某个提交对象创建别名，这样以后我们就可以通过标签来查看一些信息，创建分支等。</p>
</blockquote>
<p>###查看工作目录状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git status</div></pre></td></tr></table></figure>
<blockquote>
<p>在git命令执行后，要养成通过git status查看git状态的习惯，以便及时了解文件变化的情况。通过git status可以知道文件的状态（已修改未暂存、已删除、已修改并已暂存等待提交、未跟踪）。</p>
</blockquote>
<p>###查看提交历史 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">log</span></div><div class="line">git <span class="built_in">log</span> -p	<span class="comment">#显示每次提交文件变化</span></div></pre></td></tr></table></figure>
<blockquote>
<p>通过git log可以查看当前分支的所有提交历史，知道每次提交的commit对象的ID以及提交时附加的描述信息等。要显示更多的信息，需要使用其支持的选项，如git log -p可以将每次提交的文件变化也显示出来。</p>
</blockquote>
<p>###查看指定的提交对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git show commit_id	<span class="comment">#查看指定的某次提交内容</span></div><div class="line">git show --all		<span class="comment">#显示所有的提交历史内容</span></div><div class="line">git shortlog <span class="_">-s</span> -n	<span class="comment">#显示总的提交次数</span></div></pre></td></tr></table></figure>
<blockquote>
<p>通过<code>git log</code>可以显示整个提交历史，而通过<code>git show commit-id</code>则可以查看指定的某次提交内容，当然<code>git show -all</code>也可以显示出提交历史，另外还可以格式化显示内容。</p>
</blockquote>
<p><strong>Note : commit-id可以是commit对象对应的ID，也可以是HEAD，分支名，tag等。</strong></p>
<p>###查看工作区、暂存区、仓库之间的差异</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git diff		<span class="comment">#比较工作区与暂存区的差异</span></div><div class="line">git diff HEAD		<span class="comment">#比较工作区与仓库中最近一次的提交间的差异</span></div><div class="line">git diff --cached	<span class="comment">#比较暂存区与仓库中最近一次提交的差异</span></div><div class="line">git blame filename	<span class="comment">#可以列出该文件每次被修改的时间和内容。</span></div></pre></td></tr></table></figure>
<p>###版本回退、撤销操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">git reflog	<span class="comment">#显示提交历史的简介</span></div><div class="line">git checkout -- filename	<span class="comment">#丢弃工作区的修改</span></div><div class="line">git reset --hard HEAD^		<span class="comment">#回退到上一个版本</span></div><div class="line">git reset --hard commit_id	<span class="comment">#回退到指定版本</span></div><div class="line">git checkout -- filename	<span class="comment">#恢复工作区被删除的指定文件（文件之前被提交到仓库中）</span></div><div class="line">git checkout <span class="_">-f</span> 		<span class="comment">#恢复工作区中所有被删除的文件(文件之前被提交到仓库中)</span></div><div class="line">git ls-files <span class="_">-d</span>			<span class="comment">#列出工作区被删除的文件（文件之前被提交到仓库中）</span></div></pre></td></tr></table></figure>
<blockquote>
<p>有时候，由于我们的误操作，产生了一些错误，我们发现后希望能够及时纠正这些因为误操作而产生的结果，将工作目录恢复到某个正常状态。</p>
</blockquote>
<ul>
<li>撤销修改，但还没有添加到暂存区： <code>git checkout -- filename</code> 修改的文件会被恢复到上次提交时的状态，修改的内容会丢失。</li>
<li>版本回退：先通过<code>git reflog</code>找到某个版本的<code>commit_id</code>，然后用<code>git reset --hard commit_id</code>将工作目录的文件恢复到指定的版本。</li>
<li>恢复工作区中被删除的文件（文件之前被提交到仓库中）：<code>git checkout -- filename</code> 或 <code>git checkout -f</code></li>
</ul>
<p>###备份工作区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git stash			<span class="comment">#将工作区文件保存在Git内部栈中</span></div><div class="line">git stash list			<span class="comment">#列出Git内部栈中保存的工作区文件列表</span></div><div class="line">git stash apply stash_id	<span class="comment">#恢复工作区到指定的内部栈状态</span></div><div class="line">git stash pop			<span class="comment">#恢复工作区到上一个内部栈状态</span></div><div class="line">git stash clear			<span class="comment">#清空Git内部栈</span></div></pre></td></tr></table></figure>
<blockquote>
<p>如果正在一个develop分支上正在开发新功能，但这时master分支(稳定版本)突然发现了bug，并需要及时修复，而develop分支此时的工作还没有完成，且不希望将之前的工作就这样提交到仓库中时，这时就可以用<code>git stash</code>来暂时保存这些状态到Git内部栈中，并用当前分支上一次的提交内容来恢复工作目录，然后切换到master分支进行bug修复工作，等修复完毕并提交到仓库上后，再使用<code>git stash apply [stash@{0}]</code>或者<code>git stash pop</code>将工作目录恢复到之前的状态，继续之前的工作。</p>
<p>同时也可以多次使用git stash将未提交的代码压入到Git栈中，但当多次使用<code>git stash</code>命令后，Git栈里将充满了未提交的代码，这时候到底要用哪个版本来恢复工作目录呢？<code>git stash list</code>命令可以将当前的Git栈信息打印出来，我们只需要将找到对应的版本号，例如使用<code>git stash apply stash@{1}</code>就可以用版本号为stash@{1}的内容来恢复工作目录。</p>
<p>当Git栈中所有的内容都被恢复后，可以使用<code>git stash clear</code>来将栈清空。</p>
</blockquote>
<p>###将当前工作区目录文件压缩归档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git archive --format=zip -o arch.zip HEAD</div><div class="line">git arch --format zip head&gt;arch.zip</div></pre></td></tr></table></figure>
<p>##远程操作</p>
<blockquote>
<p>Git相比其他版本控制软件的一个优点就是大多数的操作都可以在本地进行，而不用管远程的仓库，因为操作是在本地，且操作的数据也是在本地，加上指针等原因，所以执行的速度就会比较快。 在多人协作的项目中，就需要涉及与远程仓库交互的问题，主要是如何从远程仓库抓取最新数据合并到自己的本地分支上，将自己的最新成果分享给其他人或让别人审查等 。</p>
</blockquote>
<p>###远程仓库的克隆、添加、查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">git remote	<span class="comment">#显示已添加的远程仓库名</span></div><div class="line">git remote -v 	<span class="comment">#显示已添加的远程仓库名和地址</span></div><div class="line">git remote add 远程仓库名 远程仓库地址	<span class="comment">#在本地添加远程仓库</span></div><div class="line">git remote rm 远程仓库名			<span class="comment">#删除本地添加的远程仓库名</span></div><div class="line">git remote rename 原名 新名		<span class="comment">#重命名远程仓库名</span></div><div class="line">git <span class="built_in">clone</span> 远程仓库地址 [克隆到指定的文件夹]	<span class="comment">#克隆远程仓库到本地</span></div><div class="line">git fetch 远程仓库名		<span class="comment">#从远程仓库抓取最新数据到本地但不与本地分支进行合并 </span></div><div class="line">git pull 远程仓库名	本地要合并的分支名	<span class="comment">#从远程仓库抓取最新数据并自动与本地分支进行合并</span></div><div class="line">git push 远程仓库名 本地分支名	<span class="comment">#将本地仓库推送到远程仓库中</span></div><div class="line">git remote show 远程仓库名	<span class="comment">#查看远程仓库信息</span></div><div class="line">git remote show			<span class="comment">#查看所有远程仓库</span></div><div class="line">git push 远程仓库名 标签名	<span class="comment">#将标签推送到远程仓库（Git默认不推送标签）</span></div></pre></td></tr></table></figure>
<p>###协同流程</p>
<ul>
<li>Fork远程项目</li>
<li>把Fork的项目clone到本地</li>
<li>执行以下命令，将别人的库添加为远端库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote add 远端仓库名 远端的分支</div></pre></td></tr></table></figure>
<ul>
<li>运行以下命令，拉去合并到本地</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git pull 远端仓库名 远端分支名</div></pre></td></tr></table></figure>
<ul>
<li>编辑内容</li>
<li>commit之后push到自己的库</li>
<li>登录Github，在你的首页可以看到一个<code>pull request</code>按钮，点击它，填写一些说明信息，提交即可。</li>
</ul>
<blockquote>
<p>在本地编辑内容前必须执行pull操作同步别人的远端库（这样避免冲突）</p>
</blockquote>
<p>###实用技巧</p>
<blockquote>
<p>当手头工作没有完成时，先把工作现场<code>git stash</code>一下，然后去修复bug，修复后，再使用<code>git stash pop</code>，回到工作现场.</p>
</blockquote>
<p>###多人协作技巧</p>
<blockquote>
<p>查看远程库信息，使用git remote -v；<br>本地新建的分支如果不推送到远程，对其他人就是不可见的；<br>从本地推送分支，使用<code>git push 远程仓库名 分支名</code>，如果推送失败，先用<code>git pull</code>抓取远程的新提交；<br>在本地创建和远程分支对应的分支，使用<code>git checkout -b branch-name origin/branch-name</code>，本地和远程分支的名称最好一致；<br>建立本地分支和远程分支的关联，使用<code>git branch --set-upstream branch-name origin/branch-name</code>；<br>从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</p>
</blockquote>
<p>###Git常用命令思维导图</p>
<p><img class="full-image" src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/11355916521d2e8f8fo.jpg"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://notes.wanghao.work/2015-06-29-Git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html&quot;&gt;&lt;img src=&quot;http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/git_logo.jpg&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://notes.wanghao.work/categories/Notes/"/>
    
    
      <category term="Git" scheme="https://notes.wanghao.work/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Hexo添加文章时自动打开编辑器</title>
    <link href="https://notes.wanghao.work/2015-06-29-Hexo%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%BC%96%E8%BE%91%E5%99%A8.html"/>
    <id>https://notes.wanghao.work/2015-06-29-Hexo添加文章时自动打开编辑器.html</id>
    <published>2015-06-29T09:39:55.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://notes.wanghao.work/2015-06-29-Hexo%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%BC%96%E8%BE%91%E5%99%A8.html"><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/hexo_logo.jpg" alt="" title="阅读全文"></a></p>
<a id="more"></a>
<p>在<code>Hexo</code>中新建一篇博文非常简单，只需要在命令行中键入以下命令然后回车即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo <span class="keyword">new</span> <span class="string">"The title of your blog"</span></div></pre></td></tr></table></figure>
<p>此后Hexo便会在Hexo的根目录的<code>source</code>文件夹下的<code>_posts</code>目录下自动帮你创建相应的md文件。然后我们打开该目录，找到刚刚Hexo自动生成的文件打开编辑即可。</p>
<p>但是当我们的博文比较多，这样我们就需要在成堆的Markdown文件中找到刚才自动生成的文件，这样做显然是一件比较痛苦的事情。</p>
<hr>
<p>在访问<a href="https://github.com/hexojs/hexo" target="_blank" rel="external">Hexo的Github项目</a>时，发现有类似的<a href="https://github.com/hexojs/hexo/issues/1007" target="_blank" rel="external">issue</a>，Hexo作者也给出来解决办法，以下为作者原文：</p>
<blockquote>
<p>ou can try to listen to the new event. For example:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> spawn = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</div><div class="line"></div><div class="line"><span class="comment">// Hexo 2.x</span></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</div><div class="line">  exec(<span class="string">'vi'</span>, [path]);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Hexo 3</span></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">  exec(<span class="string">'vi'</span>, [data.path]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>根据作者给出的示例，一番折腾过后博主终于在自己的机器上实验成功了，下面给出操作步骤：</p>
<ul>
<li>首先在Hexo目录下的<code>scripts</code>目录中创建一个JavaScript脚本文件。</li>
<li>如果没有这个<code>scripts</code>目录，则新建一个。</li>
<li><code>scripts</code>目录新建的JavaScript脚本文件可以任意取名。</li>
</ul>
<p>通过这个脚本，我们用其来监听<code>hexo new</code>这个动作，并在检测到<code>hexo new</code>之后，执行编辑器打开的命令。</p>
<p>如果你是<font color="red">windows平台的Hexo用户</font>，则将下列内容写入你的脚本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> spawn = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</div><div class="line"></div><div class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</div><div class="line">  exec(<span class="string">'start  "markdown编辑器绝对路径.exe" '</span> + path);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Hexo 3 用户复制这段</span></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">  exec(<span class="string">'start  "markdown编辑器绝对路径.exe" '</span> + data.path);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如果你是<font color="red">Mac平台Hexo用户</font>，则将下列内容写入你的脚本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</div><div class="line"></div><div class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</div><div class="line">    exec(<span class="string">'open -a "markdown编辑器绝对路径.app" '</span> + path);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// Hexo 3 用户复制这段</span></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">    exec(<span class="string">'open -a "markdown编辑器绝对路径.app" '</span> + data.path);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>保存并退出脚本之后，在命令行中键入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo <span class="keyword">new</span> <span class="string">"auto open editor test"</span></div></pre></td></tr></table></figure>
<p>是不是就顺利的自动打开了自动生成的md文件啦~</p>
<p>Enjoy it！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://notes.wanghao.work/2015-06-29-Hexo%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%BC%96%E8%BE%91%E5%99%A8.html&quot;&gt;&lt;img src=&quot;http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/hexo_logo.jpg&quot; alt=&quot;&quot; title=&quot;阅读全文&quot;&gt;&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Hexo" scheme="https://notes.wanghao.work/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://notes.wanghao.work/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>Digitalocean配置shadowsocks服务器、优化笔记</title>
    <link href="https://notes.wanghao.work/2015-06-17-Digitalocean%E9%85%8D%E7%BD%AEshadowsocks%E6%9C%8D%E5%8A%A1%E5%99%A8-%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0.html"/>
    <id>https://notes.wanghao.work/2015-06-17-Digitalocean配置shadowsocks服务器-优化笔记.html</id>
    <published>2015-06-17T15:45:30.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://notes.wanghao.work/2015-06-17-Digitalocean%E9%85%8D%E7%BD%AEshadowsocks%E6%9C%8D%E5%8A%A1%E5%99%A8-%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0.html"><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/digitalocean_logo.jpg" alt="alt text" title="阅读全文"></a></p>
<a id="more"></a>
<p><a ahref="#2"></a></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>由于博主一段时间更换服务器到<a href="">Digitalocean</a>的伦敦机房，结果发现丢包率以及稳定性都不如原有的旧金山机房，于是又打算更换回来。（想来真是作死啊╮(╯▽╰)╭）</p>
</blockquote>
<p>值得一提的是：<a href="https://www.digitalocean.com/?refcode=f07fa4a5aaf1" target="_blank" rel="external">Digitalocean</a>是具有数据、镜像迁移功能的。只不过由于一些这样或者那样的原因，导致博主打算重新安装<code>Shadowsocks</code>。</p>
<h3 id="Shadowsocks版本"><a href="#Shadowsocks版本" class="headerlink" title="Shadowsocks版本"></a>Shadowsocks版本</h3><p>目前<code>Shadowsocks</code>服务器端拥有四种语言版本，分别是：</p>
<ul>
<li><a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">Shadowsocks-Python</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks-libev" target="_blank" rel="external">Shadowsocks-libev</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks-go" target="_blank" rel="external">Shadowsocks-Go</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks-nodejs" target="_blank" rel="external">Shadowsocks-NodeJS</a></li>
</ul>
<p>虽然<a href="https://github.com/shadowsocks/shadowsocks-libev" target="_blank" rel="external">Shadowsocks-libev</a>版本占用内存较低，效率较高，但是考虑到不支持多用户，安装比较麻烦。因此博主采用<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">Shadowsocks-Python</a>。好了，废话不多说。下面看准备工作吧。</p>
<h3 id="Linux发行版本"><a href="#Linux发行版本" class="headerlink" title="Linux发行版本"></a>Linux发行版本</h3><p>Digitalocean 服务器镜像提供了多种选择，博主选择的是<code>Debian 7</code>的32位版本，之所以选择这个版本，基于了以下情况考虑：</p>
<ul>
<li>博主还是个新手，由于Shadowsocks作者clowwindy本人也建议除非有必要的理由，否则<a href="https://github.com/shadowsocks/shadowsocks/wiki/Shadowsocks-%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" target="_blank" rel="external">不要选择对新手不友好的CentOS</a>。</li>
<li>虽然Ubuntu对新手更为友好，但是Digitalocean家的Ubuntu系统内核，之后要用到的<a href="http://www.serverspeeder.com/" target="_blank" rel="external">锐速加速</a>不能很好的支持。</li>
</ul>
<blockquote>
<p>锐速仅支持Digitalocean下Ubuntu的<code>ubuntu14.04 x64 3.13.0-24</code>以及、<code>Ubuntu 14.04 x64 vmlinuz-3.13.0-24-generic</code>内核,又由于<code>ubuntu14.04 x64 3.13.0-24</code>内核版本较低，采用这一内核版本，若同时部署anyconnect或者Cisco IPSec VPN，会造成Cisco VPN无法正常使用。并且，开启锐速会影响Anyconnect，暂时没找到解决办法。</p>
<ul>
<li>Debian下锐速的支持以及方便的包管理。</li>
</ul>
</blockquote>
<h3 id="安装Shadowsocks"><a href="#安装Shadowsocks" class="headerlink" title="安装Shadowsocks"></a>安装Shadowsocks</h3><blockquote>
<p>以下操作假定已经取得root权限下操作完成。</p>
</blockquote>
<p>执行以下命令，将会安装<code>Shadowsocks-Python</code>版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">apt-get update  <span class="comment">#更新软件源</span></div><div class="line"></div><div class="line">apt-get install python-pip  <span class="comment">#安装pip包管理器</span></div><div class="line"></div><div class="line">pip install shadowsocks</div><div class="line"></div><div class="line">apt-get install python-m2crypto     <span class="comment">#安装加密库</span></div></pre></td></tr></table></figure>
<p>稍等片刻，系统便会自动完成Shadowsocks-Python的安装。此时Shadowsocks-Python便已近安装到系统了，接下编辑Shadowsocks的配置文件。</p>
<h3 id="配置Shadowsocks"><a href="#配置Shadowsocks" class="headerlink" title="配置Shadowsocks"></a>配置Shadowsocks</h3><p>完成安装之后，我们当然是要配置Shadowsocks服务器的账号咯，Shadowsocks的配置文件是采用JSON格式的，执行以下命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/shadowsocks.json <span class="comment">#编辑配置文件</span></div></pre></td></tr></table></figure></p>
<p>将会在<code>/etc</code>目录下新建一个文本文件，如果没有安装<code>vim</code>，请执行:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-get install vim     <span class="comment">#安装vim</span></div></pre></td></tr></table></figure></p>
<p>来完成<code>vim</code>文本编辑器的安装，你也可以只用<code>vi</code>或者<code>nano</code>编辑器来完成文本的配置。</p>
<h3 id="Shadowsocks-json语法详解"><a href="#Shadowsocks-json语法详解" class="headerlink" title="Shadowsocks.json语法详解"></a>Shadowsocks.json语法详解</h3><ul>
<li>如果你是当用户只需要一个账号的话，编辑Shadowsocks.json文件的内容为:</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"server"</span>:<span class="string">"填写你的服务器ip"</span>, </div><div class="line">    <span class="attr">"server_port"</span>:<span class="number">8388</span>,</div><div class="line">    <span class="attr">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</div><div class="line">    <span class="attr">"password"</span>:<span class="string">"mypassword"</span>,</div><div class="line">    <span class="attr">"timeout"</span>:<span class="number">300</span>,</div><div class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</div><div class="line">    <span class="attr">"fast_open"</span>: <span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果要设置多个端口号和密码，则使用下面的配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"server"</span>:<span class="string">"填写你的服务器IP"</span>, </div><div class="line">    <span class="attr">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</div><div class="line">    <span class="attr">"port_password"</span>:&#123;</div><div class="line">         <span class="attr">"端口1"</span>:<span class="string">"密码"</span>,</div><div class="line">         <span class="attr">"端口2"</span>:<span class="string">"密码"</span>,</div><div class="line">         <span class="attr">"端口3"</span>:<span class="string">"密码"</span>,</div><div class="line">         <span class="attr">"端口4"</span>:<span class="string">"密码"</span>,</div><div class="line">         <span class="attr">"端口5"</span>:<span class="string">"密码"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"timeout"</span>:<span class="number">300</span>,</div><div class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>, </div><div class="line">    <span class="attr">"fast_open"</span>: <span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>字段对应的含义如下表：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>server</td>
<td>填写你的服务器ip地址</td>
</tr>
<tr>
<td>server_port</td>
<td>填写服务器的端口号</td>
</tr>
<tr>
<td>local_port</td>
<td>填写本地监听地址，一般为127.0.0.1</td>
</tr>
<tr>
<td>local_port</td>
<td>填写本地端口号（一般为1080）</td>
</tr>
<tr>
<td>password</td>
<td>填写你的Shadowsocks密码</td>
</tr>
<tr>
<td>timeout</td>
<td>超时时间，单位为秒</td>
</tr>
<tr>
<td>method</td>
<td><a href="https://github.com/shadowsocks/shadowsocks/wiki/Encryption" target="_blank" rel="external">加密方式</a>，推荐使用aes-256-cfb加密</td>
</tr>
<tr>
<td>fast_open</td>
<td>打开或者关闭<a href="https://github.com/shadowsocks/shadowsocks/wiki/TCP-Fast-Open" target="_blank" rel="external">TCP TASTOPEN</a></td>
</tr>
</tbody>
</table>
<p>编辑完毕，保存退出即可。接来下我们就可以使用以下命令来运行我们的Shadowsocks服务器啦~</p>
<ul>
<li>前台运行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssserver -c /etc/shadowsocks.json</div></pre></td></tr></table></figure>
<ul>
<li>后台运行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ssserver -c /etc/shadowsocks.json <span class="_">-d</span> start  <span class="comment">#开始</span></div><div class="line"></div><div class="line">ssserver -c /etc/shadowsocks.json <span class="_">-d</span> stop   <span class="comment">#停止</span></div></pre></td></tr></table></figure>
<h3 id="加入开机自启"><a href="#加入开机自启" class="headerlink" title="加入开机自启"></a>加入开机自启</h3><p>虽然这样子就可以运行Shadowsocks了，但是我们肯定不希望每次我们重启服务器之后还要手动启动Shadowsocks吧，因此，我们需要将Shadowsocks设置为开机自启。</p>
<p>设置过程也非常的简单，只需要编辑<code>/etc/rc.local</code>文件，加入Shadowsocks命令即可。</p>
<p>执行以下命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/rc.local       <span class="comment">#编辑rc.local文件</span></div></pre></td></tr></table></figure></p>
<p>默认是什么都没有的空文件，如果原本有内容，只需要在<code>exit 0</code>前面加上<code>/usr/local/bin/ssserver -c /etc/shadowsocks.json -d start</code>然后退出保存即可。</p>
<p>到此，Shadowsocks-Python的安装配置就完成啦，通过我们本地的客户端连上服务器，连接<a href="https://www.youtube.com/watch?v=-YGDyPAwQz0" target="_blank" rel="external">YouTube</a>测试下速度，是这个样子的：<br><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/1134591194eba9a1aao.jpg" alt=""></p>
<p>嗯，600左右的速度，远远达不到我们心目中想要的那个速度~接下来就是我们的优化时间啦~</p>
<h3 id="内核部分的优化"><a href="#内核部分的优化" class="headerlink" title="内核部分的优化"></a>内核部分的优化</h3><p><strong>十分感谢@Way在本博文的留言所反馈的问题，针对这个问题，我重写编写了内核优化部分的配置，来解决通过Shadowsocks下载文件可能导致Shadowsocks-Python服务器端内存占用”过高”而被系统Kill的问题，该问题是因为内核参数调的太高而引起的内存异常占用。因此下面的<code>启用hybla算法</code>部分配置作废，已经配置过的朋友们请在<code>/etc/rc.local</code>文件中删除以下两句命令并重启系统再按照本部分重新配置，对此造成的不便深表歉意！</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#请删除以下两句并重启系统来使异常的配置不生效</span></div><div class="line">/sbin/sysctl -p /etc/sysctl.d/local.conf</div><div class="line"></div><div class="line"><span class="built_in">ulimit</span> -n 51200</div></pre></td></tr></table></figure>
<p><strong><em>接下来就是我们重新配置的时间啦~</em></strong></p>
<p>编辑<code>/etc/sysctl.conf</code>文件，将文件原内容全部使用<code>#</code>号注释，如果你不在意的话，也可以清空这个文件的内容，然后再添加以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">fs.file-max = 51200</div><div class="line">net.core.rmem_max = 67108864</div><div class="line">net.core.wmem_max = 67108864</div><div class="line">net.core.netdev_max_backlog = 250000</div><div class="line">net.core.somaxconn = 4096</div><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line">net.ipv4.tcp_tw_recycle = 0</div><div class="line">net.ipv4.tcp_fin_timeout = 30</div><div class="line">net.ipv4.tcp_keepalive_time = 1200</div><div class="line">net.ipv4.ip_local_port_range = 10000 65000</div><div class="line">net.ipv4.tcp_max_syn_backlog = 8192</div><div class="line">net.ipv4.tcp_max_tw_buckets = 5000</div><div class="line">net.ipv4.tcp_rmem = 4096 87380 67108864</div><div class="line">net.ipv4.tcp_wmem = 4096 65536 67108864</div><div class="line">net.ipv4.tcp_mtu_probing = 1</div><div class="line">net.ipv4.tcp_congestion_control = hybla</div></pre></td></tr></table></figure>
<p>这样我们内核的参数就重新调整完成了，</p>
<p>编辑<code>/etc/security/limits.conf</code>文件，在文件末尾加入以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">* soft nofile 51200</div><div class="line">* hard nofile 51200</div></pre></td></tr></table></figure>
<p>编辑<code>/etc/pam.d/common-session</code>文件，在文件末尾加入以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">session required pam_limits.so</div></pre></td></tr></table></figure>
<p>编辑<code>/etc/profile</code>文件，在文件末尾加入以下内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">ulimit</span> -SHn 51200</div></pre></td></tr></table></figure></p>
<p>配置完成之后，重启下系统，重启完成之后，执行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">ulimit</span> -n</div></pre></td></tr></table></figure></p>
<p>如果没有什么特殊情况，应该会得到<code>51200</code>这个结果，这就是我们想要的结果咯~这样子配置之后，就不用将<code>ulimit -n 51200</code>这句命令添加到<code>`/etc/rc.local</code>中了。这样子Shadowsocks优化就完成了，如果你使用了这部分的配置，那么下面的<code>启用hybla算法</code>部分的配置请直接跳过，因为可能会造成Shadowsocks下载文件内存异常占用而被kill的问题。</p>
<h3 id="启用hybla算法（已弃用）"><a href="#启用hybla算法（已弃用）" class="headerlink" title="启用hybla算法（已弃用）"></a><del>启用hybla算法（已弃用）</del></h3><p><strong><del>按照此方法配置可能会造成Shadowsocks下载文件而导致Shadowsocks服务器端内存异常占用而被kill，请参考上面<code>内核部分的优化</code>的配置来替换，本部分配置已经弃用！</del></strong></p>
<p><del>在<code>/etc/sysctl.d</code>目录下创建<code>local.conf</code>文件：</del></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysctl.d/local.conf</div><div class="line">```language</div></pre></td></tr></table></figure>
<p><del>添加以下内容:</del></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># max open files</span></div><div class="line">fs.file-max = 51200</div><div class="line"><span class="comment"># max read buffer</span></div><div class="line">net.core.rmem_max = 67108864</div><div class="line"><span class="comment"># max write buffer</span></div><div class="line">net.core.wmem_max = 67108864</div><div class="line"><span class="comment"># default read buffer</span></div><div class="line">net.core.rmem_default = 65536</div><div class="line"><span class="comment"># default write buffer</span></div><div class="line">net.core.wmem_default = 65536</div><div class="line"><span class="comment"># max processor input queue</span></div><div class="line">net.core.netdev_max_backlog = 4096</div><div class="line"><span class="comment"># max backlog</span></div><div class="line">net.core.somaxconn = 4096</div><div class="line"></div><div class="line"><span class="comment"># resist SYN flood attacks</span></div><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line"><span class="comment"># reuse timewait sockets when safe</span></div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line"><span class="comment"># turn off fast timewait sockets recycling</span></div><div class="line">net.ipv4.tcp_tw_recycle = 0</div><div class="line"><span class="comment"># short FIN timeout</span></div><div class="line">net.ipv4.tcp_fin_timeout = 30</div><div class="line"><span class="comment"># short keepalive time</span></div><div class="line">net.ipv4.tcp_keepalive_time = 1200</div><div class="line"><span class="comment"># outbound port range</span></div><div class="line">net.ipv4.ip_local_port_range = 10000 65000</div><div class="line"><span class="comment"># max SYN backlog</span></div><div class="line">net.ipv4.tcp_max_syn_backlog = 4096</div><div class="line"><span class="comment"># max timewait sockets held by system simultaneously</span></div><div class="line">net.ipv4.tcp_max_tw_buckets = 5000</div><div class="line"><span class="comment"># turn on TCP Fast Open on both client and server side</span></div><div class="line">net.ipv4.tcp_fastopen = 3</div><div class="line"><span class="comment"># TCP receive buffer</span></div><div class="line">net.ipv4.tcp_rmem = 4096 87380 67108864</div><div class="line"><span class="comment"># TCP write buffer</span></div><div class="line">net.ipv4.tcp_wmem = 4096 65536 67108864</div><div class="line"><span class="comment"># turn on path MTU discovery</span></div><div class="line">net.ipv4.tcp_mtu_probing = 1</div><div class="line"></div><div class="line"><span class="comment"># for high-latency network</span></div><div class="line">net.ipv4.tcp_congestion_control = hybla</div><div class="line"></div><div class="line"><span class="comment"># for low-latency network, use cubic instead</span></div><div class="line"><span class="comment"># net.ipv4.tcp_congestion_control = cubic</span></div></pre></td></tr></table></figure>
<p><del>然后保存退出，执行以下命令:</del><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysctl --system</div></pre></td></tr></table></figure></p>
<p><del>或者执行以下命令：</del><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysctl -p /etc/sysctl.d/local.conf</div></pre></td></tr></table></figure></p>
<p><del>待命令执行完毕，请<strong>务必执行以下命令</strong>:</del><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">ulimit</span> -n 51200</div></pre></td></tr></table></figure></p>
<p><del>&gt;为了在重启系统的时候 ，这些优化也生效，所以我们需要在<code>/etc/rc.local</code>中的<code>exit 0</code>前面加入这两句:</del><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/sbin/sysctl -p /etc/sysctl.d/local.conf</div><div class="line"></div><div class="line">ulimit -n 51200</div></pre></td></tr></table></figure></p>
<p>至此，Shadowsocks的优化也就结束了。但是现在的速度并没有提升太多，所以接下来需要安装<a href="http://www.serverspeeder.com/" target="_blank" rel="external">锐速</a>加速器了，它提供了20M的免费版本，个人使用时足够了。</p>
<h3 id="安装锐速"><a href="#安装锐速" class="headerlink" title="安装锐速"></a>安装锐速</h3><ul>
<li>首先，要去锐速官网注册一个账户，<a href="http://www.serverspeeder.com/" target="_blank" rel="external">传送门</a></li>
<li>然后，<a href="http://my.serverspeeder.com/w.do?m=lsl" target="_blank" rel="external">在此页面得到锐速的下载地址</a>。</li>
<li>在服务器上执行以下命令来完成锐速的安装:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://my.serverspeeder.com/d/ls/serverSpeederInstaller.tar.gz     <span class="comment">#获取锐速安装文件</span></div><div class="line"></div><div class="line">tar zxvf serverSpeederInstaller.tar.gz      <span class="comment">#解压</span></div><div class="line"></div><div class="line">bash serverSpeederInstaller.sh      <span class="comment">#执行安装脚本</span></div></pre></td></tr></table></figure>
<p>接下来便会验证你的邮箱和密码，输入即可。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">************************************************************</div><div class="line">*                                                          *</div><div class="line">*               ServerSpeeder Installer (1.2)              *</div><div class="line">*                                                          *</div><div class="line">************************************************************</div><div class="line"></div><div class="line">Email address: <span class="comment">#注册邮箱</span></div><div class="line">Password: <span class="comment">#密码</span></div></pre></td></tr></table></figure></p>
<p>接下来是配置部分，按照如下进行~:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Enter your accelerated interface(s) [eth0]: <span class="comment">#回车默认</span></div><div class="line"></div><div class="line">Enter your outbound bandwidth [1000000 kbps]: <span class="comment">#回车默认</span></div><div class="line"></div><div class="line">Enter your inbound bandwidth [1000000 kbps]: <span class="comment">#回车默认</span></div><div class="line"></div><div class="line">Configure shortRtt-bypass [0 ms]: <span class="comment">#回车默认</span></div><div class="line"></div><div class="line">Auto load ServerSpeeder on linux start-up? [n]:y <span class="comment">#是否开机自启</span></div><div class="line"></div><div class="line">Run ServerSpeeder now? [y]:y <span class="comment">#是否现在启动</span></div></pre></td></tr></table></figure>
<p>待安装完成，使用以下命令即可启动锐速加速:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/serverspeeder/bin/serverSpeeder.sh start</div></pre></td></tr></table></figure>
<p>启动之后，是不是感觉速度不升反降啦？这就对啦~所以接下来我们还需要对锐速进行一些优化配置：</p>
<p>编辑<code>/serverspeeder/etc/config</code>文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim  /serverspeeder/etc/config</div></pre></td></tr></table></figure></p>
<p>改动以下参数:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">advinacc=<span class="string">"1"</span></div><div class="line"></div><div class="line">maxmode=<span class="string">"1"</span></div><div class="line"></div><div class="line">rsc=<span class="string">"1"</span></div><div class="line"></div><div class="line">gso=<span class="string">"1"</span> <span class="comment">#主要是针对Digitalocean，其他的VPS小伙伴就请自测啦</span></div><div class="line"></div><div class="line">accppp=<span class="string">"1"</span> <span class="comment">#开启VPN加速~</span></div></pre></td></tr></table></figure>
<p>修改完毕之后，保存退出，执行以下命令重启锐速然修改生效~<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/serverspeeder/bin/serverSpeeder.sh restart</div></pre></td></tr></table></figure></p>
<p>不知道为何，博主虽然在安装锐速的时候配置的开机自启，但是重启系统之后，锐速并没有自启，因此，在<code>/etc/rc.local</code>中<code>exit 0</code>前加上一句：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/serverspeeder/bin/serverSpeeder.sh start</div></pre></td></tr></table></figure></p>
<p>退出保存，现在再连上<a href="https://www.youtube.com/watch?v=-YGDyPAwQz0" target="_blank" rel="external">YouTube</a>看看速度~如下图所示：</p>
<p><img src="http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/113459120364b2ec84o.jpg" alt=""></p>
<p>是不是相对之前就快多了呢~~博主调的是4K分辨率，虽然有些卡顿，不过1080P是完全木有问题的~<br>至此<code>Shadowsocks-Python</code>在<a href="https://www.digitalocean.com/?refcode=f07fa4a5aaf1" target="_blank" rel="external">Digitalocean</a>上的搭建、优化就完成啦~</p>
<h3 id="Digitalocean优惠"><a href="#Digitalocean优惠" class="headerlink" title="Digitalocean优惠"></a><a href="https://www.digitalocean.com/?refcode=f07fa4a5aaf1" target="_blank" rel="external">Digitalocean优惠</a></h3><blockquote>
<p>如果你还没有Digitalocean账户，想注册一个来试试的话，可以试试博主的推荐链接哦~这样我们都会得到$10美元的账户充值，购买最低配置的服务器5美元一个月足够使用两个月咯~</p>
</blockquote>
<ul>
<li><a href="https://www.digitalocean.com/?refcode=f07fa4a5aaf1" target="_blank" rel="external"><strong>点我注册Digitalocean账户</strong></a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://notes.wanghao.work/2015-06-17-Digitalocean%E9%85%8D%E7%BD%AEshadowsocks%E6%9C%8D%E5%8A%A1%E5%99%A8-%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0.html&quot;&gt;&lt;img src=&quot;http://7xkj6q.com1.z0.glb.clouddn.com/blog/image/jpg/digitalocean_logo.jpg&quot; alt=&quot;alt text&quot; title=&quot;阅读全文&quot;&gt;&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://notes.wanghao.work/categories/Linux/"/>
    
    
      <category term="shadowsocks" scheme="https://notes.wanghao.work/tags/shadowsocks/"/>
    
      <category term="digitalocean" scheme="https://notes.wanghao.work/tags/digitalocean/"/>
    
      <category term="科学上网" scheme="https://notes.wanghao.work/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>Linux学习笔记-Shell变量</title>
    <link href="https://notes.wanghao.work/2015-06-02-Shell%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"/>
    <id>https://notes.wanghao.work/2015-06-02-Shell学习笔记.html</id>
    <published>2015-06-02T01:14:41.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>在Bash中，变量的默认类型都是字符串类型的，Shell编程中，使用变量无需事先声。<br><a id="more"></a></p>
<p>###变量的命名规范</p>
<p>变量名的命名须遵循如下规则：</p>
<ul>
<li>首个字符必须为字母（a-z，A-Z）</li>
<li>中间不能有空格，可以使用下划线(_)</li>
<li>不能使用标点符号</li>
<li>不能使用bash里的关键字（可用help命令查看保留关键字）</li>
</ul>
<p>###变量的分类</p>
<blockquote>
<ul>
<li><p>用户自定义变量：用户可以自己定义。</p>
</li>
<li><p>环境变量：这种变量中主要保存的是和系统操作环境相关的数据。变量可以自动一，但是对系统生效的环境变量名和变量作用是固定的。</p>
</li>
<li><p>位置参数变量：这种变量主要是用来向脚本当中传递参数或者数据的，变量名不能自定义，变量作用是固定的。</p>
</li>
<li><p>位置参数变量：是Bash中已经定义好的变量，变量名不能自定义，变量作用也是固定的。</p>
</li>
</ul>
</blockquote>
<p>####定义变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">变量名=变量值  (等号 =两边不能带空格)</div></pre></td></tr></table></figure>
<p>####变量调用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> $变量名</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">如下示例:</div><div class="line"><span class="built_in">echo</span> <span class="variable">$x</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$name</span></div></pre></td></tr></table></figure>
<p>####变量叠加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x=123</div><div class="line">x=<span class="string">"<span class="variable">$x</span>"</span>456</div><div class="line">x=<span class="variable">$&#123;x&#125;</span>789</div></pre></td></tr></table></figure>
<p>最终使用<code>echo $x</code>将输出<code>123456789</code></p>
<p>####变量查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span></div><div class="line">    选项:</div><div class="line">        -u 如果设定此选项，调用未声明变量时会报错（默认无任何提示）</div></pre></td></tr></table></figure>
<p>####变量的删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">unset</span> 变量名  （注意，此处不能加$符号）</div></pre></td></tr></table></figure>
<p>###环境变量</p>
<p>环境变量和用户自定义变量的区别:</p>
<blockquote>
<ul>
<li><p>用户自定义变量只在当前的shell中生效，环境变量在当前shell和这个shell的所有子shell中生效。</p>
</li>
<li><p>环境变量是全局变量，用户自定义变量是局部变量。</p>
</li>
<li><p>对系统生效的环境变量名和变量作用是固定的。</p>
</li>
</ul>
</blockquote>
<p>####设置环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> 变量名=变量值</div><div class="line"></div><div class="line">变量名=变量值</div><div class="line"><span class="built_in">export</span> 变量名</div></pre></td></tr></table></figure>
<p>####查看环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span> <span class="comment">#查看所有变量</span></div><div class="line">env <span class="comment">#查看环境变量</span></div></pre></td></tr></table></figure>
<p>####常用环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">HOSTNAME：主机名</div><div class="line">SHELL：当前的shell</div><div class="line">TREM：终端环境</div><div class="line">HISTSIZE：历史命令条数</div><div class="line">SSH_CLIENT：当前操作环境是用ssh链接的，这里记录客户端的ip</div><div class="line">SSH_TTY：ssh连接的终端是pts/1</div><div class="line">USER:当前登录的用户</div></pre></td></tr></table></figure>
<p>####PATH变量</p>
<blockquote>
<p><code>PATH</code>变量：系统查找命令的路径。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span>    <span class="comment">#查看PATH变量的值</span></div><div class="line">PATH=<span class="string">"<span class="variable">$PATH</span>"</span>:/root/sh    <span class="comment">#增加PATH变量的值</span></div></pre></td></tr></table></figure>
<p>####PS1变量</p>
<blockquote>
<p><code>PS1</code>变量：命令提示符设置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- \d 显示日期，格式为”星期 月 日“</div><div class="line">- \H 显示完整的主机名<span class="string">"localhost.localdomain"</span></div><div class="line">- \t 显示24小时制时间，格式为<span class="string">"HH:MM:SS"</span></div><div class="line">- \A 显示24小时制时间，格式为<span class="string">"HH:MM"</span></div><div class="line">- \u 显示当前用户名</div><div class="line">- \w 显示当前所在目录的完整名称</div><div class="line">- \W 显示当前所在目录的最后一个目录</div><div class="line">- \$ 提示符、如果是root用户会显示提示符为<span class="string">"#"</span>,如果是普通用户会显示提示符为<span class="string">"$"</span></div></pre></td></tr></table></figure>
<p>####当前语系查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># locale    #查询当前语系</span></div><div class="line">    -LANG    定义系统主要语系（当前生效语系）</div><div class="line">    -LC:ALL    定义整体语系的变量（下次启动可能会生效）</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="variable">$LANG</span>    <span class="comment">#查看系统当前语系</span></div><div class="line"></div><div class="line">locale <span class="_">-a</span> | more    <span class="comment">#查看linux支持的所有语系</span></div><div class="line"></div><div class="line">cat /et/sysconfig/i18n    <span class="comment">#查询系统的默认语系（开机生效读取的语系环境）</span></div></pre></td></tr></table></figure>
<p>####Linux中文支持</p>
<blockquote>
<p>前提条件：正确安装中文字体和中文语系。</p>
<ul>
<li>如果有图形界面，可以正确支持中文显示。</li>
<li>如果使用第三方远程工具，只要语系设定正确，可以支持中文显示。</li>
<li>如果使用纯字符界面，必须使用第三方插件（zhcon等）</li>
</ul>
</blockquote>
<p>###位置参数变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$n</span>    n为数字，<span class="variable">$0</span>代表命令本身，<span class="variable">$1</span>~<span class="variable">$9</span>代表第一到第九个参数，十以上的参数需要用到大括号包含，如<span class="variable">$&#123;10&#125;</span>。</div><div class="line">$*    这个变量代表命令行中所有的参数，$*把所有的参数看作是一个整体。</div><div class="line"><span class="variable">$@</span>    这个变量也代表命令行中所有的参数，不过<span class="variable">$@</span>把每个参数区分呢对待。</div><div class="line"><span class="variable">$#</span>    这个变量代表命令行中所有参数的个数</div></pre></td></tr></table></figure>
<blockquote>
<p>$n 使用示例<code>sum.sh</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">num=<span class="variable">$1</span></div><div class="line">num2=<span class="variable">$2</span></div><div class="line">sum=$((<span class="variable">$num1</span>+num2))</div></pre></td></tr></table></figure>
<p>执行上述<code>sum.sh</code>脚本:</p>
<pre><code>./sum.sh 100 200
</code></pre><p>输出为300</p>
<blockquote>
<p>$* $@ $# 使用示例 <code>sum1.sh</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"\$* 参数是: $*"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"\@* 参数是: <span class="variable">$@</span>"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"\#* 参数个数是: <span class="variable">$#</span>"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>$* $@ 使用示例 <code>sum2.sh</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"$*"</span></div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"$*"</span></div><div class="line">    $*中的所有参数看成是一个整体，所以这个<span class="keyword">for</span>循环只会循环一次。</div><div class="line">	<span class="keyword">do</span></div><div class="line">		<span class="built_in">echo</span> <span class="string">" The parameter is : <span class="variable">$i</span>"</span></div><div class="line">	<span class="keyword">done</span></div><div class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></div><div class="line">    <span class="variable">$@</span>中的每个参数都看很是独立的，所有<span class="string">"<span class="variable">$@</span>"</span>中有几个参数，就会循环几次</div><div class="line">	<span class="keyword">do</span></div><div class="line">		<span class="built_in">echo</span> <span class="string">"Parameter : <span class="variable">$y</span> "</span></div><div class="line">	<span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>###预定义变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$? 最后一次执行的命令的返回状态。如果这个变量的值为0，证明上一个命令正确执行；如果这个变量的值非0（具体是哪个数，由命令自己决定），则证明上一个命令执行不正确了。</div><div class="line">$$ 当前进程的进程号（PID）</div><div class="line">$! 后台运行的最后一个进程的进程号（PID）</div></pre></td></tr></table></figure>
<p>使用示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ls</div><div class="line"><span class="built_in">echo</span> $? <span class="comment">#将在终端打印结果为0</span></div><div class="line"></div><div class="line">ls QERTYUTIYKNB</div><div class="line"><span class="built_in">echo</span> $? <span class="comment">#将在终端打印结果为2（非0）</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>其实，逻辑运算符<code>&amp;&amp;</code>(逻辑与运算）和<code>||</code>（逻辑或运算）就是通过判断前一个命令的返回值来判断命令是否正确执行。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls &amp;&amp; <span class="built_in">echo</span> yes</div><div class="line">ls || <span class="built_in">echo</span> no</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在Bash中，变量的默认类型都是字符串类型的，Shell编程中，使用变量无需事先声。&lt;br&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="https://notes.wanghao.work/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Linux" scheme="https://notes.wanghao.work/tags/Linux/"/>
    
      <category term="SHELL" scheme="https://notes.wanghao.work/tags/SHELL/"/>
    
      <category term="笔记" scheme="https://notes.wanghao.work/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>欢迎</title>
    <link href="https://notes.wanghao.work/2015-04-29-%E6%AC%A2%E8%BF%8E%E5%85%89%E4%B8%B4%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2.html"/>
    <id>https://notes.wanghao.work/2015-04-29-欢迎光临我的博客.html</id>
    <published>2015-04-29T02:02:10.000Z</published>
    <updated>2016-11-06T01:31:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>
<center><br><br><br><input type="text" id="intext" value="请输入你的英文名" onfocus="this.value=(this.value=='请输入你的英文名')?'':this.value;"><br><br><br><input type="submit" value="显示效果" onclick="xiamo(intext.value)"><br><br></center>



<script type="text/javascript" src="http://s3.amazonaws.com/codecademy-content/courses/hour-of-code/js/alphabet.js"></script>

<p><div><canvas id="myCanvas" style="width=60%"></canvas></div></p>
<script type="text/javascript" src="http://s3.amazonaws.com/codecademy-content/courses/hour-of-code/js/bubbles.js"></script>
<script type="text/javascript">

function xiamo(text_in){

var myName = text_in;

var red = [0, 100, 63];
var orange = [40, 100, 60];
var green = [75, 100, 40];
var blue = [196, 77, 55];
var purple = [280, 50, 60];
var letterColors = [red, orange, green, blue, purple];

drawName(myName, letterColors);

if(10 < 3)
{
    bubbleShape = 'square';
}
else
{
    bubbleShape = 'circle';
}

bounceBubbles();
}
xiamo("xiamo's note");
</script>]]></content>
    
    <summary type="html">
    
      &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;center&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;input type=&quot;text&quot; id=&quot;intext&quot; value=&quot;请输入你的英文名&quot; onfocus=&quot;this.value=(this.value==&#39;请输入你的英文名&#39;)?&#39;&#39;:this.v
    
    </summary>
    
      <category term="折腾" scheme="https://notes.wanghao.work/categories/%E6%8A%98%E8%85%BE/"/>
    
    
      <category term="欢迎" scheme="https://notes.wanghao.work/tags/%E6%AC%A2%E8%BF%8E/"/>
    
  </entry>
  
</feed>
